ARM GAS  /tmp/ccXDZrk8.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"foc.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.set_dtc,"ax",%progbits
  18              		.align	1
  19              		.global	set_dtc
  20              		.arch armv7e-m
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  24              		.fpu fpv4-sp-d16
  26              	set_dtc:
  27              	.LVL0:
  28              	.LFB235:
  29              		.file 1 "Core/Src/foc.c"
   1:Core/Src/foc.c **** /*
   2:Core/Src/foc.c ****  * foc.c
   3:Core/Src/foc.c ****  *
   4:Core/Src/foc.c ****  *  Created on: Aug 2, 2020
   5:Core/Src/foc.c ****  *      Author: ben
   6:Core/Src/foc.c ****  */
   7:Core/Src/foc.c **** 
   8:Core/Src/foc.c **** #include "foc.h"
   9:Core/Src/foc.c **** #include "adc.h"
  10:Core/Src/foc.c **** #include "tim.h"
  11:Core/Src/foc.c **** #include "position_sensor.h"
  12:Core/Src/foc.c **** #include "math_ops.h"
  13:Core/Src/foc.c **** #include "hw_config.h"
  14:Core/Src/foc.c **** #include "user_config.h"
  15:Core/Src/foc.c **** 
  16:Core/Src/foc.c **** void set_dtc(ControllerStruct *controller){
  30              		.loc 1 16 43 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		@ link register save eliminated.
  17:Core/Src/foc.c **** 
  18:Core/Src/foc.c **** 	/* Invert duty cycle if that's how hardware is configured */
  19:Core/Src/foc.c **** 
  20:Core/Src/foc.c **** 	float dtc_u = controller->dtc_u;
  35              		.loc 1 20 2 view .LVU1
  36              		.loc 1 20 8 is_stmt 0 view .LVU2
  37 0000 90ED176A 		vldr.32	s12, [r0, #92]
  38              	.LVL1:
ARM GAS  /tmp/ccXDZrk8.s 			page 2


  21:Core/Src/foc.c **** 	float dtc_v = controller->dtc_v;
  39              		.loc 1 21 2 is_stmt 1 view .LVU3
  40              		.loc 1 21 8 is_stmt 0 view .LVU4
  41 0004 90ED187A 		vldr.32	s14, [r0, #96]
  42              	.LVL2:
  22:Core/Src/foc.c **** 	float dtc_w = controller->dtc_w;
  43              		.loc 1 22 2 is_stmt 1 view .LVU5
  44              		.loc 1 22 8 is_stmt 0 view .LVU6
  45 0008 D0ED195A 		vldr.32	s11, [r0, #100]
  46              	.LVL3:
  23:Core/Src/foc.c **** 
  24:Core/Src/foc.c **** 	if(INVERT_DTC){
  47              		.loc 1 24 2 is_stmt 1 view .LVU7
  25:Core/Src/foc.c **** 		dtc_u = 1.0f - controller->dtc_u;
  48              		.loc 1 25 3 view .LVU8
  49              		.loc 1 25 9 is_stmt 0 view .LVU9
  50 000c F7EE007A 		vmov.f32	s15, #1.0e+0
  51 0010 37EEC66A 		vsub.f32	s12, s15, s12
  52              	.LVL4:
  26:Core/Src/foc.c **** 		dtc_v = 1.0f - controller->dtc_v;
  53              		.loc 1 26 3 is_stmt 1 view .LVU10
  54              		.loc 1 26 9 is_stmt 0 view .LVU11
  55 0014 77EEC76A 		vsub.f32	s13, s15, s14
  56              	.LVL5:
  27:Core/Src/foc.c **** 		dtc_w = 1.0f - controller->dtc_w;
  57              		.loc 1 27 3 is_stmt 1 view .LVU12
  58              		.loc 1 27 9 is_stmt 0 view .LVU13
  59 0018 77EEE57A 		vsub.f32	s15, s15, s11
  60              	.LVL6:
  28:Core/Src/foc.c **** 	}
  29:Core/Src/foc.c **** 	/* Handle phase order swapping so that voltage/current/torque match encoder direction */
  30:Core/Src/foc.c **** 	if(!PHASE_ORDER){
  61              		.loc 1 30 2 is_stmt 1 view .LVU14
  62              		.loc 1 30 6 is_stmt 0 view .LVU15
  63 001c 224B     		ldr	r3, .L4
  64 001e 1B68     		ldr	r3, [r3]
  65              		.loc 1 30 4 view .LVU16
  66 0020 03BB     		cbnz	r3, .L2
  31:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_U, ((TIM_PWM.Instance->ARR))*dtc_u);
  67              		.loc 1 31 3 is_stmt 1 view .LVU17
  68 0022 224B     		ldr	r3, .L4+4
  69 0024 1B68     		ldr	r3, [r3]
  70 0026 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
  71 002a B8EE477A 		vcvt.f32.u32	s14, s14
  72 002e 27EE067A 		vmul.f32	s14, s14, s12
  73 0032 BCEEC77A 		vcvt.u32.f32	s14, s14
  74 0036 83ED0D7A 		vstr.32	s14, [r3, #52]	@ int
  32:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_V, ((TIM_PWM.Instance->ARR))*dtc_v);
  75              		.loc 1 32 3 view .LVU18
  76 003a 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
  77 003e B8EE477A 		vcvt.f32.u32	s14, s14
  78 0042 27EE267A 		vmul.f32	s14, s14, s13
  79 0046 BCEEC77A 		vcvt.u32.f32	s14, s14
  80 004a 83ED0E7A 		vstr.32	s14, [r3, #56]	@ int
  33:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_W, ((TIM_PWM.Instance->ARR))*dtc_w);
  81              		.loc 1 33 3 view .LVU19
  82 004e 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
ARM GAS  /tmp/ccXDZrk8.s 			page 3


  83 0052 B8EE477A 		vcvt.f32.u32	s14, s14
  84 0056 67EE277A 		vmul.f32	s15, s14, s15
  85              	.LVL7:
  86              		.loc 1 33 3 is_stmt 0 view .LVU20
  87 005a FCEEE77A 		vcvt.u32.f32	s15, s15
  88 005e C3ED0F7A 		vstr.32	s15, [r3, #60]	@ int
  89 0062 7047     		bx	lr
  90              	.LVL8:
  91              	.L2:
  34:Core/Src/foc.c **** 	}
  35:Core/Src/foc.c **** 	else{
  36:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_V, ((TIM_PWM.Instance->ARR))*dtc_u);
  92              		.loc 1 36 3 is_stmt 1 view .LVU21
  93 0064 114B     		ldr	r3, .L4+4
  94 0066 1B68     		ldr	r3, [r3]
  95 0068 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
  96 006c B8EE477A 		vcvt.f32.u32	s14, s14
  97 0070 27EE067A 		vmul.f32	s14, s14, s12
  98 0074 BCEEC77A 		vcvt.u32.f32	s14, s14
  99 0078 83ED0E7A 		vstr.32	s14, [r3, #56]	@ int
  37:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_U, ((TIM_PWM.Instance->ARR))*dtc_v);
 100              		.loc 1 37 3 view .LVU22
 101 007c 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
 102 0080 B8EE477A 		vcvt.f32.u32	s14, s14
 103 0084 27EE267A 		vmul.f32	s14, s14, s13
 104 0088 BCEEC77A 		vcvt.u32.f32	s14, s14
 105 008c 83ED0D7A 		vstr.32	s14, [r3, #52]	@ int
  38:Core/Src/foc.c **** 		__HAL_TIM_SET_COMPARE(&TIM_PWM, TIM_CH_W, ((TIM_PWM.Instance->ARR))*dtc_w);
 106              		.loc 1 38 3 view .LVU23
 107 0090 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
 108 0094 B8EE477A 		vcvt.f32.u32	s14, s14
 109 0098 67EE277A 		vmul.f32	s15, s14, s15
 110              	.LVL9:
 111              		.loc 1 38 3 is_stmt 0 view .LVU24
 112 009c FCEEE77A 		vcvt.u32.f32	s15, s15
 113 00a0 C3ED0F7A 		vstr.32	s15, [r3, #60]	@ int
  39:Core/Src/foc.c **** 	}
  40:Core/Src/foc.c **** }
 114              		.loc 1 40 1 view .LVU25
 115 00a4 7047     		bx	lr
 116              	.L5:
 117 00a6 00BF     		.align	2
 118              	.L4:
 119 00a8 00000000 		.word	__int_reg
 120 00ac 00000000 		.word	htim1
 121              		.cfi_endproc
 122              	.LFE235:
 124              		.section	.text.analog_sample,"ax",%progbits
 125              		.align	1
 126              		.global	analog_sample
 127              		.syntax unified
 128              		.thumb
 129              		.thumb_func
 130              		.fpu fpv4-sp-d16
 132              	analog_sample:
 133              	.LVL10:
 134              	.LFB236:
ARM GAS  /tmp/ccXDZrk8.s 			page 4


  41:Core/Src/foc.c **** 
  42:Core/Src/foc.c **** void analog_sample (ControllerStruct *controller){
 135              		.loc 1 42 50 is_stmt 1 view -0
 136              		.cfi_startproc
 137              		@ args = 0, pretend = 0, frame = 0
 138              		@ frame_needed = 0, uses_anonymous_args = 0
 139              		.loc 1 42 50 is_stmt 0 view .LVU27
 140 0000 38B5     		push	{r3, r4, r5, lr}
 141              	.LCFI0:
 142              		.cfi_def_cfa_offset 16
 143              		.cfi_offset 3, -16
 144              		.cfi_offset 4, -12
 145              		.cfi_offset 5, -8
 146              		.cfi_offset 14, -4
 147 0002 0446     		mov	r4, r0
  43:Core/Src/foc.c **** 	/* Sampe ADCs */
  44:Core/Src/foc.c **** 	/* Handle phase order swapping so that voltage/current/torque match encoder direction */
  45:Core/Src/foc.c **** 	if(!PHASE_ORDER){
 148              		.loc 1 45 2 is_stmt 1 view .LVU28
 149              		.loc 1 45 6 is_stmt 0 view .LVU29
 150 0004 264B     		ldr	r3, .L10
 151 0006 1B68     		ldr	r3, [r3]
 152              		.loc 1 45 4 view .LVU30
 153 0008 002B     		cmp	r3, #0
 154 000a 3FD1     		bne	.L7
  46:Core/Src/foc.c **** 		controller->adc_a_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 155              		.loc 1 46 3 is_stmt 1 view .LVU31
 156              		.loc 1 46 27 is_stmt 0 view .LVU32
 157 000c 2548     		ldr	r0, .L10+4
 158              	.LVL11:
 159              		.loc 1 46 27 view .LVU33
 160 000e FFF7FEFF 		bl	HAL_ADC_GetValue
 161              	.LVL12:
 162              		.loc 1 46 25 view .LVU34
 163 0012 6060     		str	r0, [r4, #4]
  47:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IB);
 164              		.loc 1 47 3 is_stmt 1 view .LVU35
 165              		.loc 1 47 27 is_stmt 0 view .LVU36
 166 0014 2448     		ldr	r0, .L10+8
 167 0016 FFF7FEFF 		bl	HAL_ADC_GetValue
 168              	.LVL13:
 169              		.loc 1 47 25 view .LVU37
 170 001a A060     		str	r0, [r4, #8]
 171              	.L8:
  48:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IC;
  49:Core/Src/foc.c **** 	}
  50:Core/Src/foc.c **** 	else{
  51:Core/Src/foc.c **** 		controller->adc_a_raw = HAL_ADC_GetValue(&ADC_CH_IB);
  52:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
  53:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IB;
  54:Core/Src/foc.c **** 	}
  55:Core/Src/foc.c **** 
  56:Core/Src/foc.c **** 
  57:Core/Src/foc.c **** 	HAL_ADC_Start(&ADC_CH_MAIN);
 172              		.loc 1 57 2 is_stmt 1 view .LVU38
 173 001c 214D     		ldr	r5, .L10+4
 174 001e 2846     		mov	r0, r5
ARM GAS  /tmp/ccXDZrk8.s 			page 5


 175 0020 FFF7FEFF 		bl	HAL_ADC_Start
 176              	.LVL14:
  58:Core/Src/foc.c **** 	HAL_ADC_PollForConversion(&ADC_CH_MAIN, HAL_MAX_DELAY);
 177              		.loc 1 58 2 view .LVU39
 178 0024 4FF0FF31 		mov	r1, #-1
 179 0028 2846     		mov	r0, r5
 180 002a FFF7FEFF 		bl	HAL_ADC_PollForConversion
 181              	.LVL15:
  59:Core/Src/foc.c **** 
  60:Core/Src/foc.c **** 	controller->adc_vbus_raw = HAL_ADC_GetValue(&ADC_CH_VBUS);
 182              		.loc 1 60 2 view .LVU40
 183              		.loc 1 60 29 is_stmt 0 view .LVU41
 184 002e 1F48     		ldr	r0, .L10+12
 185 0030 FFF7FEFF 		bl	HAL_ADC_GetValue
 186              	.LVL16:
 187              		.loc 1 60 27 view .LVU42
 188 0034 2061     		str	r0, [r4, #16]
  61:Core/Src/foc.c **** 	controller->v_bus = (float)controller->adc_vbus_raw*V_SCALE;
 189              		.loc 1 61 2 is_stmt 1 view .LVU43
 190              		.loc 1 61 22 is_stmt 0 view .LVU44
 191 0036 07EE900A 		vmov	s15, r0	@ int
 192 003a F8EEE77A 		vcvt.f32.s32	s15, s15
 193              		.loc 1 61 53 view .LVU45
 194 003e 9FED1C7A 		vldr.32	s14, .L10+16
 195 0042 67EE877A 		vmul.f32	s15, s15, s14
 196              		.loc 1 61 20 view .LVU46
 197 0046 C4ED087A 		vstr.32	s15, [r4, #32]
  62:Core/Src/foc.c **** 
  63:Core/Src/foc.c ****     controller->i_a = controller->i_scale*(float)(controller->adc_a_raw - controller->adc_a_offset)
 198              		.loc 1 63 5 is_stmt 1 view .LVU47
 199              		.loc 1 63 33 is_stmt 0 view .LVU48
 200 004a D4ED1D6A 		vldr.32	s13, [r4, #116]
 201              		.loc 1 63 61 view .LVU49
 202 004e 6368     		ldr	r3, [r4, #4]
 203              		.loc 1 63 85 view .LVU50
 204 0050 D4F89C20 		ldr	r2, [r4, #156]
 205              		.loc 1 63 73 view .LVU51
 206 0054 9B1A     		subs	r3, r3, r2
 207 0056 07EE903A 		vmov	s15, r3	@ int
 208              		.loc 1 63 43 view .LVU52
 209 005a F8EEE77A 		vcvt.f32.s32	s15, s15
 210              		.loc 1 63 42 view .LVU53
 211 005e 66EEA77A 		vmul.f32	s15, s13, s15
 212              		.loc 1 63 21 view .LVU54
 213 0062 C4ED057A 		vstr.32	s15, [r4, #20]
  64:Core/Src/foc.c ****     controller->i_b = controller->i_scale*(float)(controller->adc_b_raw - controller->adc_b_offset)
 214              		.loc 1 64 5 is_stmt 1 view .LVU55
 215              		.loc 1 64 61 is_stmt 0 view .LVU56
 216 0066 A368     		ldr	r3, [r4, #8]
 217              		.loc 1 64 85 view .LVU57
 218 0068 D4F8A020 		ldr	r2, [r4, #160]
 219              		.loc 1 64 73 view .LVU58
 220 006c 9B1A     		subs	r3, r3, r2
 221 006e 07EE103A 		vmov	s14, r3	@ int
 222              		.loc 1 64 43 view .LVU59
 223 0072 B8EEC77A 		vcvt.f32.s32	s14, s14
 224              		.loc 1 64 42 view .LVU60
ARM GAS  /tmp/ccXDZrk8.s 			page 6


 225 0076 26EE877A 		vmul.f32	s14, s13, s14
 226              		.loc 1 64 21 view .LVU61
 227 007a 84ED067A 		vstr.32	s14, [r4, #24]
  65:Core/Src/foc.c ****     controller->i_c = -controller->i_a - controller->i_b;
 228              		.loc 1 65 5 is_stmt 1 view .LVU62
 229              		.loc 1 65 23 is_stmt 0 view .LVU63
 230 007e F1EE677A 		vneg.f32	s15, s15
 231              		.loc 1 65 40 view .LVU64
 232 0082 77EEC77A 		vsub.f32	s15, s15, s14
 233              		.loc 1 65 21 view .LVU65
 234 0086 C4ED077A 		vstr.32	s15, [r4, #28]
  66:Core/Src/foc.c **** 
  67:Core/Src/foc.c **** }
 235              		.loc 1 67 1 view .LVU66
 236 008a 38BD     		pop	{r3, r4, r5, pc}
 237              	.LVL17:
 238              	.L7:
  51:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 239              		.loc 1 51 3 is_stmt 1 view .LVU67
  51:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 240              		.loc 1 51 27 is_stmt 0 view .LVU68
 241 008c 0648     		ldr	r0, .L10+8
 242              	.LVL18:
  51:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 243              		.loc 1 51 27 view .LVU69
 244 008e FFF7FEFF 		bl	HAL_ADC_GetValue
 245              	.LVL19:
  51:Core/Src/foc.c **** 		controller->adc_b_raw = HAL_ADC_GetValue(&ADC_CH_IA);
 246              		.loc 1 51 25 view .LVU70
 247 0092 6060     		str	r0, [r4, #4]
  52:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IB;
 248              		.loc 1 52 3 is_stmt 1 view .LVU71
  52:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IB;
 249              		.loc 1 52 27 is_stmt 0 view .LVU72
 250 0094 0348     		ldr	r0, .L10+4
 251 0096 FFF7FEFF 		bl	HAL_ADC_GetValue
 252              	.LVL20:
  52:Core/Src/foc.c **** 		//adc_ch_ic = ADC_CH_IB;
 253              		.loc 1 52 25 view .LVU73
 254 009a A060     		str	r0, [r4, #8]
 255 009c BEE7     		b	.L8
 256              	.L11:
 257 009e 00BF     		.align	2
 258              	.L10:
 259 00a0 00000000 		.word	__int_reg
 260 00a4 00000000 		.word	hadc1
 261 00a8 00000000 		.word	hadc2
 262 00ac 00000000 		.word	hadc3
 263 00b0 1833533C 		.word	1012085528
 264              		.cfi_endproc
 265              	.LFE236:
 267              		.section	.text.abc,"ax",%progbits
 268              		.align	1
 269              		.global	abc
 270              		.syntax unified
 271              		.thumb
 272              		.thumb_func
ARM GAS  /tmp/ccXDZrk8.s 			page 7


 273              		.fpu fpv4-sp-d16
 275              	abc:
 276              	.LVL21:
 277              	.LFB237:
  68:Core/Src/foc.c **** 
  69:Core/Src/foc.c **** void abc( float theta, float d, float q, float *a, float *b, float *c){
 278              		.loc 1 69 71 is_stmt 1 view -0
 279              		.cfi_startproc
 280              		@ args = 0, pretend = 0, frame = 0
 281              		@ frame_needed = 0, uses_anonymous_args = 0
 282              		.loc 1 69 71 is_stmt 0 view .LVU75
 283 0000 70B5     		push	{r4, r5, r6, lr}
 284              	.LCFI1:
 285              		.cfi_def_cfa_offset 16
 286              		.cfi_offset 4, -16
 287              		.cfi_offset 5, -12
 288              		.cfi_offset 6, -8
 289              		.cfi_offset 14, -4
 290 0002 2DED048B 		vpush.64	{d8, d9}
 291              	.LCFI2:
 292              		.cfi_def_cfa_offset 32
 293              		.cfi_offset 80, -32
 294              		.cfi_offset 81, -28
 295              		.cfi_offset 82, -24
 296              		.cfi_offset 83, -20
 297 0006 F0EE409A 		vmov.f32	s19, s0
 298 000a B0EE609A 		vmov.f32	s18, s1
 299 000e F0EE418A 		vmov.f32	s17, s2
 300 0012 0646     		mov	r6, r0
 301 0014 0D46     		mov	r5, r1
 302 0016 1446     		mov	r4, r2
  70:Core/Src/foc.c ****     /* Inverse DQ0 Transform
  71:Core/Src/foc.c ****     Phase current amplitude = lengh of dq vector
  72:Core/Src/foc.c ****     i.e. iq = 1, id = 0, peak phase current of 1 */
  73:Core/Src/foc.c **** 
  74:Core/Src/foc.c ****     float cf = cos_lut(theta);
 303              		.loc 1 74 5 is_stmt 1 view .LVU76
 304              		.loc 1 74 16 is_stmt 0 view .LVU77
 305 0018 FFF7FEFF 		bl	cos_lut
 306              	.LVL22:
 307              		.loc 1 74 16 view .LVU78
 308 001c B0EE408A 		vmov.f32	s16, s0
 309              	.LVL23:
  75:Core/Src/foc.c ****     float sf = sin_lut(theta);
 310              		.loc 1 75 5 is_stmt 1 view .LVU79
 311              		.loc 1 75 16 is_stmt 0 view .LVU80
 312 0020 B0EE690A 		vmov.f32	s0, s19
 313              	.LVL24:
 314              		.loc 1 75 16 view .LVU81
 315 0024 FFF7FEFF 		bl	sin_lut
 316              	.LVL25:
  76:Core/Src/foc.c **** 
  77:Core/Src/foc.c ****     *a = cf*d - sf*q;
 317              		.loc 1 77 5 is_stmt 1 view .LVU82
 318              		.loc 1 77 12 is_stmt 0 view .LVU83
 319 0028 68EE097A 		vmul.f32	s15, s16, s18
 320              		.loc 1 77 19 view .LVU84
ARM GAS  /tmp/ccXDZrk8.s 			page 8


 321 002c 20EE287A 		vmul.f32	s14, s0, s17
 322              		.loc 1 77 15 view .LVU85
 323 0030 77EEC77A 		vsub.f32	s15, s15, s14
 324              		.loc 1 77 8 view .LVU86
 325 0034 C6ED007A 		vstr.32	s15, [r6]
  78:Core/Src/foc.c ****     *b = (SQRT3_2*sf-.5f*cf)*d - (-SQRT3_2*cf-.5f*sf)*q;
 326              		.loc 1 78 5 is_stmt 1 view .LVU87
 327              		.loc 1 78 18 is_stmt 0 view .LVU88
 328 0038 9FED166A 		vldr.32	s12, .L14
 329 003c 20EE067A 		vmul.f32	s14, s0, s12
 330              		.loc 1 78 25 view .LVU89
 331 0040 B6EE001A 		vmov.f32	s2, #5.0e-1
 332 0044 68EE010A 		vmul.f32	s1, s16, s2
 333              		.loc 1 78 21 view .LVU90
 334 0048 37EE607A 		vsub.f32	s14, s14, s1
 335              		.loc 1 78 29 view .LVU91
 336 004c 27EE097A 		vmul.f32	s14, s14, s18
 337              		.loc 1 78 43 view .LVU92
 338 0050 DFED117A 		vldr.32	s15, .L14+4
 339 0054 68EE276A 		vmul.f32	s13, s16, s15
 340              		.loc 1 78 50 view .LVU93
 341 0058 20EE011A 		vmul.f32	s2, s0, s2
 342              		.loc 1 78 46 view .LVU94
 343 005c 76EEC16A 		vsub.f32	s13, s13, s2
 344              		.loc 1 78 54 view .LVU95
 345 0060 66EEA86A 		vmul.f32	s13, s13, s17
 346              		.loc 1 78 32 view .LVU96
 347 0064 37EE667A 		vsub.f32	s14, s14, s13
 348              		.loc 1 78 8 view .LVU97
 349 0068 85ED007A 		vstr.32	s14, [r5]
  79:Core/Src/foc.c ****     *c = (-SQRT3_2*sf-.5f*cf)*d - (SQRT3_2*cf-.5f*sf)*q;
 350              		.loc 1 79 5 is_stmt 1 view .LVU98
 351              		.loc 1 79 19 is_stmt 0 view .LVU99
 352 006c 60EE277A 		vmul.f32	s15, s0, s15
 353              		.loc 1 79 22 view .LVU100
 354 0070 77EEE07A 		vsub.f32	s15, s15, s1
 355              		.loc 1 79 30 view .LVU101
 356 0074 67EE890A 		vmul.f32	s1, s15, s18
 357              		.loc 1 79 43 view .LVU102
 358 0078 28EE068A 		vmul.f32	s16, s16, s12
 359              	.LVL26:
 360              		.loc 1 79 46 view .LVU103
 361 007c 38EE418A 		vsub.f32	s16, s16, s2
 362              		.loc 1 79 54 view .LVU104
 363 0080 28EE281A 		vmul.f32	s2, s16, s17
 364              		.loc 1 79 33 view .LVU105
 365 0084 30EEC11A 		vsub.f32	s2, s1, s2
 366              		.loc 1 79 8 view .LVU106
 367 0088 84ED001A 		vstr.32	s2, [r4]
  80:Core/Src/foc.c ****     }
 368              		.loc 1 80 5 view .LVU107
 369 008c BDEC048B 		vldm	sp!, {d8-d9}
 370              	.LCFI3:
 371              		.cfi_restore 82
 372              		.cfi_restore 83
 373              		.cfi_restore 80
 374              		.cfi_restore 81
ARM GAS  /tmp/ccXDZrk8.s 			page 9


 375              		.cfi_def_cfa_offset 16
 376              	.LVL27:
 377              		.loc 1 80 5 view .LVU108
 378 0090 70BD     		pop	{r4, r5, r6, pc}
 379              	.LVL28:
 380              	.L15:
 381              		.loc 1 80 5 view .LVU109
 382 0092 00BF     		.align	2
 383              	.L14:
 384 0094 D7B35D3F 		.word	1063105495
 385 0098 D7B35DBF 		.word	3210589143
 386              		.cfi_endproc
 387              	.LFE237:
 389              		.section	.text.dq0,"ax",%progbits
 390              		.align	1
 391              		.global	dq0
 392              		.syntax unified
 393              		.thumb
 394              		.thumb_func
 395              		.fpu fpv4-sp-d16
 397              	dq0:
 398              	.LVL29:
 399              	.LFB238:
  81:Core/Src/foc.c **** 
  82:Core/Src/foc.c **** 
  83:Core/Src/foc.c **** void dq0(float theta, float a, float b, float c, float *d, float *q){
 400              		.loc 1 83 69 is_stmt 1 view -0
 401              		.cfi_startproc
 402              		@ args = 0, pretend = 0, frame = 0
 403              		@ frame_needed = 0, uses_anonymous_args = 0
 404              		.loc 1 83 69 is_stmt 0 view .LVU111
 405 0000 38B5     		push	{r3, r4, r5, lr}
 406              	.LCFI4:
 407              		.cfi_def_cfa_offset 16
 408              		.cfi_offset 3, -16
 409              		.cfi_offset 4, -12
 410              		.cfi_offset 5, -8
 411              		.cfi_offset 14, -4
 412 0002 2DED068B 		vpush.64	{d8, d9, d10}
 413              	.LCFI5:
 414              		.cfi_def_cfa_offset 40
 415              		.cfi_offset 80, -40
 416              		.cfi_offset 81, -36
 417              		.cfi_offset 82, -32
 418              		.cfi_offset 83, -28
 419              		.cfi_offset 84, -24
 420              		.cfi_offset 85, -20
 421 0006 B0EE40AA 		vmov.f32	s20, s0
 422 000a B0EE608A 		vmov.f32	s16, s1
 423 000e F0EE419A 		vmov.f32	s19, s2
 424 0012 B0EE619A 		vmov.f32	s18, s3
 425 0016 0546     		mov	r5, r0
 426 0018 0C46     		mov	r4, r1
  84:Core/Src/foc.c ****     /* DQ0 Transform
  85:Core/Src/foc.c ****     Phase current amplitude = lengh of dq vector
  86:Core/Src/foc.c ****     i.e. iq = 1, id = 0, peak phase current of 1*/
  87:Core/Src/foc.c **** 
ARM GAS  /tmp/ccXDZrk8.s 			page 10


  88:Core/Src/foc.c ****     float cf = cos_lut(theta);
 427              		.loc 1 88 5 is_stmt 1 view .LVU112
 428              		.loc 1 88 16 is_stmt 0 view .LVU113
 429 001a FFF7FEFF 		bl	cos_lut
 430              	.LVL30:
 431              		.loc 1 88 16 view .LVU114
 432 001e F0EE408A 		vmov.f32	s17, s0
 433              	.LVL31:
  89:Core/Src/foc.c ****     float sf = sin_lut(theta);
 434              		.loc 1 89 5 is_stmt 1 view .LVU115
 435              		.loc 1 89 16 is_stmt 0 view .LVU116
 436 0022 B0EE4A0A 		vmov.f32	s0, s20
 437              	.LVL32:
 438              		.loc 1 89 16 view .LVU117
 439 0026 FFF7FEFF 		bl	sin_lut
 440              	.LVL33:
  90:Core/Src/foc.c **** 
  91:Core/Src/foc.c ****     *d = 0.6666667f*(cf*a + (SQRT3_2*sf-.5f*cf)*b + (-SQRT3_2*sf-.5f*cf)*c);   ///Faster DQ0 Transf
 441              		.loc 1 91 5 is_stmt 1 view .LVU118
 442              		.loc 1 91 24 is_stmt 0 view .LVU119
 443 002a 28EE887A 		vmul.f32	s14, s17, s16
 444              		.loc 1 91 37 view .LVU120
 445 002e DFED1C1A 		vldr.32	s3, .L18
 446 0032 60EE217A 		vmul.f32	s15, s0, s3
 447              		.loc 1 91 44 view .LVU121
 448 0036 B6EE006A 		vmov.f32	s12, #5.0e-1
 449 003a 68EE865A 		vmul.f32	s11, s17, s12
 450              		.loc 1 91 40 view .LVU122
 451 003e 77EEE57A 		vsub.f32	s15, s15, s11
 452              		.loc 1 91 48 view .LVU123
 453 0042 67EEA97A 		vmul.f32	s15, s15, s19
 454              		.loc 1 91 27 view .LVU124
 455 0046 37EE277A 		vadd.f32	s14, s14, s15
 456              		.loc 1 91 62 view .LVU125
 457 004a DFED167A 		vldr.32	s15, .L18+4
 458 004e 60EE276A 		vmul.f32	s13, s0, s15
 459              		.loc 1 91 65 view .LVU126
 460 0052 76EEE56A 		vsub.f32	s13, s13, s11
 461              		.loc 1 91 73 view .LVU127
 462 0056 66EE896A 		vmul.f32	s13, s13, s18
 463              		.loc 1 91 51 view .LVU128
 464 005a 37EE267A 		vadd.f32	s14, s14, s13
 465              		.loc 1 91 20 view .LVU129
 466 005e DFED126A 		vldr.32	s13, .L18+8
 467 0062 27EE267A 		vmul.f32	s14, s14, s13
 468              		.loc 1 91 8 view .LVU130
 469 0066 85ED007A 		vstr.32	s14, [r5]
  92:Core/Src/foc.c ****     *q = 0.6666667f*(-sf*a - (-SQRT3_2*cf-.5f*sf)*b - (SQRT3_2*cf-.5f*sf)*c);
 470              		.loc 1 92 5 is_stmt 1 view .LVU131
 471              		.loc 1 92 25 is_stmt 0 view .LVU132
 472 006a 20EE488A 		vnmul.f32	s16, s0, s16
 473              	.LVL34:
 474              		.loc 1 92 39 view .LVU133
 475 006e 68EEA77A 		vmul.f32	s15, s17, s15
 476              		.loc 1 92 46 view .LVU134
 477 0072 20EE060A 		vmul.f32	s0, s0, s12
 478              	.LVL35:
ARM GAS  /tmp/ccXDZrk8.s 			page 11


 479              		.loc 1 92 42 view .LVU135
 480 0076 77EEC07A 		vsub.f32	s15, s15, s0
 481              		.loc 1 92 50 view .LVU136
 482 007a 27EEA91A 		vmul.f32	s2, s15, s19
 483              		.loc 1 92 28 view .LVU137
 484 007e 38EE418A 		vsub.f32	s16, s16, s2
 485              		.loc 1 92 63 view .LVU138
 486 0082 68EEA18A 		vmul.f32	s17, s17, s3
 487              	.LVL36:
 488              		.loc 1 92 66 view .LVU139
 489 0086 78EEC08A 		vsub.f32	s17, s17, s0
 490              		.loc 1 92 74 view .LVU140
 491 008a 68EE891A 		vmul.f32	s3, s17, s18
 492              		.loc 1 92 53 view .LVU141
 493 008e 38EE618A 		vsub.f32	s16, s16, s3
 494              		.loc 1 92 20 view .LVU142
 495 0092 28EE268A 		vmul.f32	s16, s16, s13
 496              		.loc 1 92 8 view .LVU143
 497 0096 84ED008A 		vstr.32	s16, [r4]
  93:Core/Src/foc.c **** 
  94:Core/Src/foc.c ****     }
 498              		.loc 1 94 5 view .LVU144
 499 009a BDEC068B 		vldm	sp!, {d8-d10}
 500              	.LCFI6:
 501              		.cfi_restore 84
 502              		.cfi_restore 85
 503              		.cfi_restore 82
 504              		.cfi_restore 83
 505              		.cfi_restore 80
 506              		.cfi_restore 81
 507              		.cfi_def_cfa_offset 16
 508              	.LVL37:
 509              		.loc 1 94 5 view .LVU145
 510 009e 38BD     		pop	{r3, r4, r5, pc}
 511              	.LVL38:
 512              	.L19:
 513              		.loc 1 94 5 view .LVU146
 514              		.align	2
 515              	.L18:
 516 00a0 D7B35D3F 		.word	1063105495
 517 00a4 D7B35DBF 		.word	3210589143
 518 00a8 ABAA2A3F 		.word	1059760811
 519              		.cfi_endproc
 520              	.LFE238:
 522              		.section	.text.svm,"ax",%progbits
 523              		.align	1
 524              		.global	svm
 525              		.syntax unified
 526              		.thumb
 527              		.thumb_func
 528              		.fpu fpv4-sp-d16
 530              	svm:
 531              	.LVL39:
 532              	.LFB239:
  95:Core/Src/foc.c **** 
  96:Core/Src/foc.c **** void svm(float v_max, float u, float v, float w, float *dtc_u, float *dtc_v, float *dtc_w){
 533              		.loc 1 96 91 is_stmt 1 view -0
ARM GAS  /tmp/ccXDZrk8.s 			page 12


 534              		.cfi_startproc
 535              		@ args = 0, pretend = 0, frame = 0
 536              		@ frame_needed = 0, uses_anonymous_args = 0
 537              		.loc 1 96 91 is_stmt 0 view .LVU148
 538 0000 70B5     		push	{r4, r5, r6, lr}
 539              	.LCFI7:
 540              		.cfi_def_cfa_offset 16
 541              		.cfi_offset 4, -16
 542              		.cfi_offset 5, -12
 543              		.cfi_offset 6, -8
 544              		.cfi_offset 14, -4
 545 0002 2DED088B 		vpush.64	{d8, d9, d10, d11}
 546              	.LCFI8:
 547              		.cfi_def_cfa_offset 48
 548              		.cfi_offset 80, -48
 549              		.cfi_offset 81, -44
 550              		.cfi_offset 82, -40
 551              		.cfi_offset 83, -36
 552              		.cfi_offset 84, -32
 553              		.cfi_offset 85, -28
 554              		.cfi_offset 86, -24
 555              		.cfi_offset 87, -20
 556 0006 B0EE40AA 		vmov.f32	s20, s0
 557 000a F0EE609A 		vmov.f32	s19, s1
 558 000e B0EE419A 		vmov.f32	s18, s2
 559 0012 B0EE618A 		vmov.f32	s16, s3
 560 0016 0646     		mov	r6, r0
 561 0018 0D46     		mov	r5, r1
 562 001a 1446     		mov	r4, r2
  97:Core/Src/foc.c ****     /* Space Vector Modulation
  98:Core/Src/foc.c ****      u,v,w amplitude = v_bus for full modulation depth */
  99:Core/Src/foc.c **** 
 100:Core/Src/foc.c ****     float v_offset = (fminf3(u, v, w) + fmaxf3(u, v, w))*0.5f;
 563              		.loc 1 100 5 is_stmt 1 view .LVU149
 564              		.loc 1 100 23 is_stmt 0 view .LVU150
 565 001c B0EE611A 		vmov.f32	s2, s3
 566              	.LVL40:
 567              		.loc 1 100 23 view .LVU151
 568 0020 F0EE490A 		vmov.f32	s1, s18
 569              	.LVL41:
 570              		.loc 1 100 23 view .LVU152
 571 0024 B0EE690A 		vmov.f32	s0, s19
 572              	.LVL42:
 573              		.loc 1 100 23 view .LVU153
 574 0028 FFF7FEFF 		bl	fminf3
 575              	.LVL43:
 576              		.loc 1 100 23 view .LVU154
 577 002c F0EE408A 		vmov.f32	s17, s0
 578              		.loc 1 100 41 view .LVU155
 579 0030 B0EE481A 		vmov.f32	s2, s16
 580 0034 F0EE490A 		vmov.f32	s1, s18
 581 0038 B0EE690A 		vmov.f32	s0, s19
 582 003c FFF7FEFF 		bl	fmaxf3
 583              	.LVL44:
 584              		.loc 1 100 39 view .LVU156
 585 0040 78EE808A 		vadd.f32	s17, s17, s0
 586              		.loc 1 100 11 view .LVU157
ARM GAS  /tmp/ccXDZrk8.s 			page 13


 587 0044 F6EE00AA 		vmov.f32	s21, #5.0e-1
 588 0048 68EEAA8A 		vmul.f32	s17, s17, s21
 589              	.LVL45:
 101:Core/Src/foc.c ****     float v_midpoint = .5f*(DTC_MAX+DTC_MIN);
 590              		.loc 1 101 5 is_stmt 1 view .LVU158
 102:Core/Src/foc.c **** 
 103:Core/Src/foc.c ****     *dtc_u = fast_fminf(fast_fmaxf((.5f*(u -v_offset)*OVERMODULATION/v_max + v_midpoint ), DTC_MIN)
 591              		.loc 1 103 5 view .LVU159
 592              		.loc 1 103 44 is_stmt 0 view .LVU160
 593 004c 79EEE89A 		vsub.f32	s19, s19, s17
 594              	.LVL46:
 595              		.loc 1 103 54 view .LVU161
 596 0050 69EEAA9A 		vmul.f32	s19, s19, s21
 597              		.loc 1 103 69 view .LVU162
 598 0054 89EE8A0A 		vdiv.f32	s0, s19, s20
 599              		.loc 1 103 14 view .LVU163
 600 0058 DFED1CBA 		vldr.32	s23, .L22
 601 005c 9FED1CBA 		vldr.32	s22, .L22+4
 602 0060 F0EE6B0A 		vmov.f32	s1, s23
 603 0064 30EE0B0A 		vadd.f32	s0, s0, s22
 604 0068 FFF7FEFF 		bl	fast_fmaxf
 605              	.LVL47:
 606 006c DFED199A 		vldr.32	s19, .L22+8
 607 0070 F0EE690A 		vmov.f32	s1, s19
 608 0074 FFF7FEFF 		bl	fast_fminf
 609              	.LVL48:
 610              		.loc 1 103 12 view .LVU164
 611 0078 86ED000A 		vstr.32	s0, [r6]
 104:Core/Src/foc.c ****     *dtc_v = fast_fminf(fast_fmaxf((.5f*(v -v_offset)*OVERMODULATION/v_max + v_midpoint ), DTC_MIN)
 612              		.loc 1 104 5 is_stmt 1 view .LVU165
 613              		.loc 1 104 44 is_stmt 0 view .LVU166
 614 007c 39EE689A 		vsub.f32	s18, s18, s17
 615              	.LVL49:
 616              		.loc 1 104 54 view .LVU167
 617 0080 29EE2A9A 		vmul.f32	s18, s18, s21
 618              		.loc 1 104 69 view .LVU168
 619 0084 89EE0A0A 		vdiv.f32	s0, s18, s20
 620              		.loc 1 104 14 view .LVU169
 621 0088 F0EE6B0A 		vmov.f32	s1, s23
 622 008c 30EE0B0A 		vadd.f32	s0, s0, s22
 623 0090 FFF7FEFF 		bl	fast_fmaxf
 624              	.LVL50:
 625 0094 F0EE690A 		vmov.f32	s1, s19
 626 0098 FFF7FEFF 		bl	fast_fminf
 627              	.LVL51:
 628              		.loc 1 104 12 view .LVU170
 629 009c 85ED000A 		vstr.32	s0, [r5]
 105:Core/Src/foc.c ****     *dtc_w = fast_fminf(fast_fmaxf((.5f*(w -v_offset)*OVERMODULATION/v_max + v_midpoint ), DTC_MIN)
 630              		.loc 1 105 5 is_stmt 1 view .LVU171
 631              		.loc 1 105 44 is_stmt 0 view .LVU172
 632 00a0 38EE688A 		vsub.f32	s16, s16, s17
 633              	.LVL52:
 634              		.loc 1 105 54 view .LVU173
 635 00a4 28EE2A8A 		vmul.f32	s16, s16, s21
 636              		.loc 1 105 69 view .LVU174
 637 00a8 88EE0A0A 		vdiv.f32	s0, s16, s20
 638              		.loc 1 105 14 view .LVU175
ARM GAS  /tmp/ccXDZrk8.s 			page 14


 639 00ac F0EE6B0A 		vmov.f32	s1, s23
 640 00b0 30EE0B0A 		vadd.f32	s0, s0, s22
 641 00b4 FFF7FEFF 		bl	fast_fmaxf
 642              	.LVL53:
 643 00b8 F0EE690A 		vmov.f32	s1, s19
 644 00bc FFF7FEFF 		bl	fast_fminf
 645              	.LVL54:
 646              		.loc 1 105 12 view .LVU176
 647 00c0 84ED000A 		vstr.32	s0, [r4]
 106:Core/Src/foc.c **** 
 107:Core/Src/foc.c ****     }
 648              		.loc 1 107 5 view .LVU177
 649 00c4 BDEC088B 		vldm	sp!, {d8-d11}
 650              	.LCFI9:
 651              		.cfi_restore 86
 652              		.cfi_restore 87
 653              		.cfi_restore 84
 654              		.cfi_restore 85
 655              		.cfi_restore 82
 656              		.cfi_restore 83
 657              		.cfi_restore 80
 658              		.cfi_restore 81
 659              		.cfi_def_cfa_offset 16
 660              	.LVL55:
 661              		.loc 1 107 5 view .LVU178
 662 00c8 70BD     		pop	{r4, r5, r6, pc}
 663              	.LVL56:
 664              	.L23:
 665              		.loc 1 107 5 view .LVU179
 666 00ca 00BF     		.align	2
 667              	.L22:
 668 00cc 00000000 		.word	0
 669 00d0 D7A3F03E 		.word	1055957975
 670 00d4 D7A3703F 		.word	1064346583
 671              		.cfi_endproc
 672              	.LFE239:
 674              		.section	.text.zero_current,"ax",%progbits
 675              		.align	1
 676              		.global	zero_current
 677              		.syntax unified
 678              		.thumb
 679              		.thumb_func
 680              		.fpu fpv4-sp-d16
 682              	zero_current:
 683              	.LVL57:
 684              	.LFB240:
 108:Core/Src/foc.c **** 
 109:Core/Src/foc.c **** void zero_current(ControllerStruct *controller){
 685              		.loc 1 109 48 is_stmt 1 view -0
 686              		.cfi_startproc
 687              		@ args = 0, pretend = 0, frame = 0
 688              		@ frame_needed = 0, uses_anonymous_args = 0
 689              		.loc 1 109 48 is_stmt 0 view .LVU181
 690 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 691              	.LCFI10:
 692              		.cfi_def_cfa_offset 24
 693              		.cfi_offset 3, -24
ARM GAS  /tmp/ccXDZrk8.s 			page 15


 694              		.cfi_offset 4, -20
 695              		.cfi_offset 5, -16
 696              		.cfi_offset 6, -12
 697              		.cfi_offset 7, -8
 698              		.cfi_offset 14, -4
 699 0002 0446     		mov	r4, r0
 110:Core/Src/foc.c **** 	/* Measure zero-current ADC offset */
 111:Core/Src/foc.c **** 
 112:Core/Src/foc.c ****     int adc_a_offset = 0;
 700              		.loc 1 112 5 is_stmt 1 view .LVU182
 701              	.LVL58:
 113:Core/Src/foc.c ****     int adc_b_offset = 0;
 702              		.loc 1 113 5 view .LVU183
 114:Core/Src/foc.c ****     int n = 1000;
 703              		.loc 1 114 5 view .LVU184
 115:Core/Src/foc.c ****     controller->dtc_u = 0.f;
 704              		.loc 1 115 5 view .LVU185
 705              		.loc 1 115 23 is_stmt 0 view .LVU186
 706 0004 0023     		movs	r3, #0
 707 0006 C365     		str	r3, [r0, #92]	@ float
 116:Core/Src/foc.c ****     controller->dtc_v = 0.f;
 708              		.loc 1 116 5 is_stmt 1 view .LVU187
 709              		.loc 1 116 23 is_stmt 0 view .LVU188
 710 0008 0366     		str	r3, [r0, #96]	@ float
 117:Core/Src/foc.c ****     controller->dtc_w = 0.f;
 711              		.loc 1 117 5 is_stmt 1 view .LVU189
 712              		.loc 1 117 23 is_stmt 0 view .LVU190
 713 000a 4366     		str	r3, [r0, #100]	@ float
 118:Core/Src/foc.c ****     set_dtc(controller);
 714              		.loc 1 118 5 is_stmt 1 view .LVU191
 715 000c FFF7FEFF 		bl	set_dtc
 716              	.LVL59:
 119:Core/Src/foc.c **** 
 120:Core/Src/foc.c ****     for (int i = 0; i<n; i++){               // Average n samples
 717              		.loc 1 120 5 view .LVU192
 718              	.LBB2:
 719              		.loc 1 120 10 view .LVU193
 720              		.loc 1 120 14 is_stmt 0 view .LVU194
 721 0010 0025     		movs	r5, #0
 722              	.LBE2:
 113:Core/Src/foc.c ****     int n = 1000;
 723              		.loc 1 113 9 view .LVU195
 724 0012 2E46     		mov	r6, r5
 112:Core/Src/foc.c ****     int adc_b_offset = 0;
 725              		.loc 1 112 9 view .LVU196
 726 0014 2F46     		mov	r7, r5
 727              	.LVL60:
 728              	.L25:
 729              	.LBB3:
 730              		.loc 1 120 21 is_stmt 1 discriminator 1 view .LVU197
 731              		.loc 1 120 5 is_stmt 0 discriminator 1 view .LVU198
 732 0016 B5F57A7F 		cmp	r5, #1000
 733 001a 08DA     		bge	.L28
 121:Core/Src/foc.c ****     	analog_sample(controller);
 734              		.loc 1 121 6 is_stmt 1 discriminator 3 view .LVU199
 735 001c 2046     		mov	r0, r4
 736 001e FFF7FEFF 		bl	analog_sample
ARM GAS  /tmp/ccXDZrk8.s 			page 16


 737              	.LVL61:
 122:Core/Src/foc.c ****     	adc_a_offset +=  controller->adc_a_raw;
 738              		.loc 1 122 6 discriminator 3 view .LVU200
 739              		.loc 1 122 33 is_stmt 0 discriminator 3 view .LVU201
 740 0022 6368     		ldr	r3, [r4, #4]
 741              		.loc 1 122 19 discriminator 3 view .LVU202
 742 0024 1F44     		add	r7, r7, r3
 743              	.LVL62:
 123:Core/Src/foc.c ****     	adc_b_offset += controller->adc_b_raw;
 744              		.loc 1 123 6 is_stmt 1 discriminator 3 view .LVU203
 745              		.loc 1 123 32 is_stmt 0 discriminator 3 view .LVU204
 746 0026 A368     		ldr	r3, [r4, #8]
 747              		.loc 1 123 19 discriminator 3 view .LVU205
 748 0028 1E44     		add	r6, r6, r3
 749              	.LVL63:
 120:Core/Src/foc.c ****     	analog_sample(controller);
 750              		.loc 1 120 26 is_stmt 1 discriminator 3 view .LVU206
 120:Core/Src/foc.c ****     	analog_sample(controller);
 751              		.loc 1 120 27 is_stmt 0 discriminator 3 view .LVU207
 752 002a 0135     		adds	r5, r5, #1
 753              	.LVL64:
 120:Core/Src/foc.c ****     	analog_sample(controller);
 754              		.loc 1 120 27 discriminator 3 view .LVU208
 755 002c F3E7     		b	.L25
 756              	.L28:
 120:Core/Src/foc.c ****     	analog_sample(controller);
 757              		.loc 1 120 27 discriminator 3 view .LVU209
 758              	.LBE3:
 124:Core/Src/foc.c ****      }
 125:Core/Src/foc.c ****     controller->adc_a_offset = adc_a_offset/n;
 759              		.loc 1 125 5 is_stmt 1 view .LVU210
 760              		.loc 1 125 44 is_stmt 0 view .LVU211
 761 002e 084A     		ldr	r2, .L29
 762 0030 82FB0731 		smull	r3, r1, r2, r7
 763 0034 FB17     		asrs	r3, r7, #31
 764 0036 C3EBA113 		rsb	r3, r3, r1, asr #6
 765              		.loc 1 125 30 view .LVU212
 766 003a C4F89C30 		str	r3, [r4, #156]
 126:Core/Src/foc.c ****     controller->adc_b_offset = adc_b_offset/n;
 767              		.loc 1 126 5 is_stmt 1 view .LVU213
 768              		.loc 1 126 44 is_stmt 0 view .LVU214
 769 003e 82FB0632 		smull	r3, r2, r2, r6
 770 0042 F317     		asrs	r3, r6, #31
 771 0044 C3EBA213 		rsb	r3, r3, r2, asr #6
 772              		.loc 1 126 30 view .LVU215
 773 0048 C4F8A030 		str	r3, [r4, #160]
 127:Core/Src/foc.c **** 
 128:Core/Src/foc.c ****     }
 774              		.loc 1 128 5 view .LVU216
 775 004c F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 776              	.LVL65:
 777              	.L30:
 778              		.loc 1 128 5 view .LVU217
 779 004e 00BF     		.align	2
 780              	.L29:
 781 0050 D34D6210 		.word	274877907
 782              		.cfi_endproc
ARM GAS  /tmp/ccXDZrk8.s 			page 17


 783              	.LFE240:
 785              		.global	__aeabi_f2d
 786              		.global	__aeabi_dmul
 787              		.global	__aeabi_dadd
 788              		.global	__aeabi_d2f
 789              		.section	.text.init_controller_params,"ax",%progbits
 790              		.align	1
 791              		.global	init_controller_params
 792              		.syntax unified
 793              		.thumb
 794              		.thumb_func
 795              		.fpu fpv4-sp-d16
 797              	init_controller_params:
 798              	.LVL66:
 799              	.LFB241:
 129:Core/Src/foc.c **** 
 130:Core/Src/foc.c **** void init_controller_params(ControllerStruct *controller){
 800              		.loc 1 130 58 is_stmt 1 view -0
 801              		.cfi_startproc
 802              		@ args = 0, pretend = 0, frame = 0
 803              		@ frame_needed = 0, uses_anonymous_args = 0
 804              		.loc 1 130 58 is_stmt 0 view .LVU219
 805 0000 38B5     		push	{r3, r4, r5, lr}
 806              	.LCFI11:
 807              		.cfi_def_cfa_offset 16
 808              		.cfi_offset 3, -16
 809              		.cfi_offset 4, -12
 810              		.cfi_offset 5, -8
 811              		.cfi_offset 14, -4
 812 0002 0546     		mov	r5, r0
 131:Core/Src/foc.c **** 
 132:Core/Src/foc.c **** 	controller->ki_d = KI_D;
 813              		.loc 1 132 2 is_stmt 1 view .LVU220
 814              		.loc 1 132 19 is_stmt 0 view .LVU221
 815 0004 374B     		ldr	r3, .L41
 816 0006 C0F88030 		str	r3, [r0, #128]	@ float
 133:Core/Src/foc.c ****     controller->ki_q = KI_Q;
 817              		.loc 1 133 5 is_stmt 1 view .LVU222
 818              		.loc 1 133 22 is_stmt 0 view .LVU223
 819 000a C0F88430 		str	r3, [r0, #132]	@ float
 134:Core/Src/foc.c ****     controller->k_d = K_SCALE*I_BW;
 820              		.loc 1 134 5 is_stmt 1 view .LVU224
 821              		.loc 1 134 31 is_stmt 0 view .LVU225
 822 000e 364B     		ldr	r3, .L41+4
 823 0010 D3ED027A 		vldr.32	s15, [r3, #8]
 824              		.loc 1 134 30 view .LVU226
 825 0014 9FED357A 		vldr.32	s14, .L41+8
 826 0018 27EE877A 		vmul.f32	s14, s15, s14
 827              		.loc 1 134 21 view .LVU227
 828 001c 80ED1E7A 		vstr.32	s14, [r0, #120]
 135:Core/Src/foc.c ****     controller->k_q = K_SCALE*I_BW;
 829              		.loc 1 135 5 is_stmt 1 view .LVU228
 830              		.loc 1 135 21 is_stmt 0 view .LVU229
 831 0020 80ED1F7A 		vstr.32	s14, [r0, #124]
 136:Core/Src/foc.c ****     controller->alpha = 1.0f - 1.0f/(1.0f - DT*I_BW*TWO_PI_F);
 832              		.loc 1 136 5 is_stmt 1 view .LVU230
 833              		.loc 1 136 47 is_stmt 0 view .LVU231
ARM GAS  /tmp/ccXDZrk8.s 			page 18


 834 0024 9FED327A 		vldr.32	s14, .L41+12
 835 0028 67EE877A 		vmul.f32	s15, s15, s14
 836              		.loc 1 136 52 view .LVU232
 837 002c 9FED317A 		vldr.32	s14, .L41+16
 838 0030 67EE877A 		vmul.f32	s15, s15, s14
 839              		.loc 1 136 43 view .LVU233
 840 0034 B7EE007A 		vmov.f32	s14, #1.0e+0
 841 0038 77EE677A 		vsub.f32	s15, s14, s15
 842              		.loc 1 136 36 view .LVU234
 843 003c C7EE276A 		vdiv.f32	s13, s14, s15
 844              		.loc 1 136 30 view .LVU235
 845 0040 37EE667A 		vsub.f32	s14, s14, s13
 846              		.loc 1 136 23 view .LVU236
 847 0044 80ED237A 		vstr.32	s14, [r0, #140]
 137:Core/Src/foc.c ****     controller->ki_fw = .1f*controller->ki_d;
 848              		.loc 1 137 5 is_stmt 1 view .LVU237
 849              		.loc 1 137 23 is_stmt 0 view .LVU238
 850 0048 2B4A     		ldr	r2, .L41+20
 851 004a C0F88820 		str	r2, [r0, #136]	@ float
 138:Core/Src/foc.c ****     controller->phase_order = PHASE_ORDER;
 852              		.loc 1 138 5 is_stmt 1 view .LVU239
 853              		.loc 1 138 31 is_stmt 0 view .LVU240
 854 004e 2B4A     		ldr	r2, .L41+24
 855 0050 1268     		ldr	r2, [r2]
 856              		.loc 1 138 29 view .LVU241
 857 0052 C0F8D420 		str	r2, [r0, #212]
 139:Core/Src/foc.c ****     controller->flux_linkage = KT/(1.5f*PPAIRS);
 858              		.loc 1 139 5 is_stmt 1 view .LVU242
 859              		.loc 1 139 32 is_stmt 0 view .LVU243
 860 0056 D3ED0E6A 		vldr.32	s13, [r3, #56]
 861              		.loc 1 139 41 view .LVU244
 862 005a D3ED0A7A 		vldr.32	s15, [r3, #40]
 863              		.loc 1 139 40 view .LVU245
 864 005e B7EE087A 		vmov.f32	s14, #1.5e+0
 865 0062 67EE877A 		vmul.f32	s15, s15, s14
 866              		.loc 1 139 34 view .LVU246
 867 0066 86EEA77A 		vdiv.f32	s14, s13, s15
 868              		.loc 1 139 30 view .LVU247
 869 006a 80ED247A 		vstr.32	s14, [r0, #144]
 140:Core/Src/foc.c ****     if(I_MAX <= 40.0f){controller->i_scale = I_SCALE;}
 870              		.loc 1 140 5 is_stmt 1 view .LVU248
 871              		.loc 1 140 8 is_stmt 0 view .LVU249
 872 006e 93ED037A 		vldr.32	s14, [r3, #12]
 873              		.loc 1 140 7 view .LVU250
 874 0072 DFED237A 		vldr.32	s15, .L41+28
 875 0076 B4EEE77A 		vcmpe.f32	s14, s15
 876 007a F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 877 007e 2CD8     		bhi	.L38
 878              		.loc 1 140 24 is_stmt 1 discriminator 1 view .LVU251
 879              		.loc 1 140 44 is_stmt 0 discriminator 1 view .LVU252
 880 0080 204B     		ldr	r3, .L41+32
 881 0082 4367     		str	r3, [r0, #116]	@ float
 882              	.L35:
 130:Core/Src/foc.c **** 
 883              		.loc 1 130 58 discriminator 1 view .LVU253
 884 0084 0024     		movs	r4, #0
 885              	.LVL67:
ARM GAS  /tmp/ccXDZrk8.s 			page 19


 886              	.L34:
 887              	.LBB4:
 141:Core/Src/foc.c ****     else{controller->i_scale = 2.0f*I_SCALE;}
 142:Core/Src/foc.c ****     for(int i = 0; i<128; i++)	// Approximate duty cycle linearization
 888              		.loc 1 142 20 is_stmt 1 discriminator 1 view .LVU254
 889              		.loc 1 142 5 is_stmt 0 discriminator 1 view .LVU255
 890 0086 7F2C     		cmp	r4, #127
 891 0088 2ADC     		bgt	.L40
 143:Core/Src/foc.c ****     {
 144:Core/Src/foc.c ****         controller->inverter_tab[i] = 1.0f + 1.2f*exp(-0.0078125f*i/.032f);
 892              		.loc 1 144 9 is_stmt 1 discriminator 3 view .LVU256
 893              		.loc 1 144 66 is_stmt 0 discriminator 3 view .LVU257
 894 008a 07EE904A 		vmov	s15, r4	@ int
 895 008e F8EEE77A 		vcvt.f32.s32	s15, s15
 896 0092 9FED1D7A 		vldr.32	s14, .L41+36
 897 0096 67EE877A 		vmul.f32	s15, s15, s14
 898              		.loc 1 144 51 discriminator 3 view .LVU258
 899 009a 9FED1C7A 		vldr.32	s14, .L41+40
 900 009e C7EE877A 		vdiv.f32	s15, s15, s14
 901 00a2 17EE900A 		vmov	r0, s15
 902 00a6 FFF7FEFF 		bl	__aeabi_f2d
 903              	.LVL68:
 904 00aa 41EC100B 		vmov	d0, r0, r1
 905 00ae FFF7FEFF 		bl	exp
 906              	.LVL69:
 907              		.loc 1 144 50 discriminator 3 view .LVU259
 908 00b2 4FF08042 		mov	r2, #1073741824
 909 00b6 164B     		ldr	r3, .L41+44
 910 00b8 51EC100B 		vmov	r0, r1, d0
 911 00bc FFF7FEFF 		bl	__aeabi_dmul
 912              	.LVL70:
 913              		.loc 1 144 44 discriminator 3 view .LVU260
 914 00c0 0022     		movs	r2, #0
 915 00c2 144B     		ldr	r3, .L41+48
 916 00c4 FFF7FEFF 		bl	__aeabi_dadd
 917              	.LVL71:
 918 00c8 FFF7FEFF 		bl	__aeabi_d2f
 919              	.LVL72:
 920              		.loc 1 144 37 discriminator 3 view .LVU261
 921 00cc 04F14003 		add	r3, r4, #64
 922 00d0 05EB8303 		add	r3, r5, r3, lsl #2
 923 00d4 5860     		str	r0, [r3, #4]	@ float
 142:Core/Src/foc.c ****     {
 924              		.loc 1 142 27 is_stmt 1 discriminator 3 view .LVU262
 142:Core/Src/foc.c ****     {
 925              		.loc 1 142 28 is_stmt 0 discriminator 3 view .LVU263
 926 00d6 0134     		adds	r4, r4, #1
 927              	.LVL73:
 142:Core/Src/foc.c ****     {
 928              		.loc 1 142 28 discriminator 3 view .LVU264
 929 00d8 D5E7     		b	.L34
 930              	.LVL74:
 931              	.L38:
 142:Core/Src/foc.c ****     {
 932              		.loc 1 142 28 discriminator 3 view .LVU265
 933              	.LBE4:
 141:Core/Src/foc.c ****     else{controller->i_scale = 2.0f*I_SCALE;}
ARM GAS  /tmp/ccXDZrk8.s 			page 20


 934              		.loc 1 141 10 is_stmt 1 view .LVU266
 141:Core/Src/foc.c ****     else{controller->i_scale = 2.0f*I_SCALE;}
 935              		.loc 1 141 30 is_stmt 0 view .LVU267
 936 00da 0F4B     		ldr	r3, .L41+52
 937 00dc 4367     		str	r3, [r0, #116]	@ float
 938 00de D1E7     		b	.L35
 939              	.LVL75:
 940              	.L40:
 145:Core/Src/foc.c ****     }
 146:Core/Src/foc.c **** 
 147:Core/Src/foc.c ****     }
 941              		.loc 1 147 5 view .LVU268
 942 00e0 38BD     		pop	{r3, r4, r5, pc}
 943              	.LVL76:
 944              	.L42:
 945              		.loc 1 147 5 view .LVU269
 946 00e2 00BF     		.align	2
 947              	.L41:
 948 00e4 EC51383D 		.word	1027101164
 949 00e8 00000000 		.word	__float_reg
 950 00ec 82A8FB38 		.word	956016770
 951 00f0 17B7D137 		.word	936490775
 952 00f4 DB0FC940 		.word	1086918619
 953 00f8 BD74933B 		.word	999519421
 954 00fc 00000000 		.word	__int_reg
 955 0100 00002042 		.word	1109393408
 956 0104 FFFFA43C 		.word	1017446399
 957 0108 000000BC 		.word	3154116608
 958 010c 6F12033D 		.word	1023611503
 959 0110 3333F33F 		.word	1072902963
 960 0114 0000F03F 		.word	1072693248
 961 0118 FFFF243D 		.word	1025835007
 962              		.cfi_endproc
 963              	.LFE241:
 965              		.section	.text.reset_foc,"ax",%progbits
 966              		.align	1
 967              		.global	reset_foc
 968              		.syntax unified
 969              		.thumb
 970              		.thumb_func
 971              		.fpu fpv4-sp-d16
 973              	reset_foc:
 974              	.LVL77:
 975              	.LFB242:
 148:Core/Src/foc.c **** 
 149:Core/Src/foc.c **** void reset_foc(ControllerStruct *controller){
 976              		.loc 1 149 45 is_stmt 1 view -0
 977              		.cfi_startproc
 978              		@ args = 0, pretend = 0, frame = 0
 979              		@ frame_needed = 0, uses_anonymous_args = 0
 980              		@ link register save eliminated.
 150:Core/Src/foc.c **** 
 151:Core/Src/foc.c **** 	TIM_PWM.Instance->CCR3 = ((TIM_PWM.Instance->ARR))*(0.5f);
 981              		.loc 1 151 2 view .LVU271
 982              		.loc 1 151 36 is_stmt 0 view .LVU272
 983 0000 1A4B     		ldr	r3, .L44
 984 0002 1B68     		ldr	r3, [r3]
ARM GAS  /tmp/ccXDZrk8.s 			page 21


 985              		.loc 1 151 45 view .LVU273
 986 0004 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
 987              		.loc 1 151 52 view .LVU274
 988 0008 B8EE477A 		vcvt.f32.u32	s14, s14
 989 000c F6EE006A 		vmov.f32	s13, #5.0e-1
 990 0010 27EE267A 		vmul.f32	s14, s14, s13
 991              		.loc 1 151 25 view .LVU275
 992 0014 BCEEC77A 		vcvt.u32.f32	s14, s14
 993 0018 83ED0F7A 		vstr.32	s14, [r3, #60]	@ int
 152:Core/Src/foc.c **** 	TIM_PWM.Instance->CCR1 = ((TIM_PWM.Instance->ARR))*(0.5f);
 994              		.loc 1 152 2 is_stmt 1 view .LVU276
 995              		.loc 1 152 45 is_stmt 0 view .LVU277
 996 001c 93ED0B7A 		vldr.32	s14, [r3, #44]	@ int
 997              		.loc 1 152 52 view .LVU278
 998 0020 B8EE477A 		vcvt.f32.u32	s14, s14
 999 0024 27EE267A 		vmul.f32	s14, s14, s13
 1000              		.loc 1 152 25 view .LVU279
 1001 0028 BCEEC77A 		vcvt.u32.f32	s14, s14
 1002 002c 83ED0D7A 		vstr.32	s14, [r3, #52]	@ int
 153:Core/Src/foc.c **** 	TIM_PWM.Instance->CCR2 = ((TIM_PWM.Instance->ARR))*(0.5f);
 1003              		.loc 1 153 2 is_stmt 1 view .LVU280
 1004              		.loc 1 153 45 is_stmt 0 view .LVU281
 1005 0030 D3ED0B7A 		vldr.32	s15, [r3, #44]	@ int
 1006              		.loc 1 153 52 view .LVU282
 1007 0034 F8EE677A 		vcvt.f32.u32	s15, s15
 1008 0038 67EEA67A 		vmul.f32	s15, s15, s13
 1009              		.loc 1 153 25 view .LVU283
 1010 003c FCEEE77A 		vcvt.u32.f32	s15, s15
 1011 0040 C3ED0E7A 		vstr.32	s15, [r3, #56]	@ int
 154:Core/Src/foc.c ****     controller->i_d_des = 0;
 1012              		.loc 1 154 5 is_stmt 1 view .LVU284
 1013              		.loc 1 154 25 is_stmt 0 view .LVU285
 1014 0044 0023     		movs	r3, #0
 1015 0046 C0F8AC30 		str	r3, [r0, #172]	@ float
 155:Core/Src/foc.c ****     controller->i_q_des = 0;
 1016              		.loc 1 155 5 is_stmt 1 view .LVU286
 1017              		.loc 1 155 25 is_stmt 0 view .LVU287
 1018 004a C0F8B030 		str	r3, [r0, #176]	@ float
 156:Core/Src/foc.c ****     controller->i_d = 0;
 1019              		.loc 1 156 5 is_stmt 1 view .LVU288
 1020              		.loc 1 156 21 is_stmt 0 view .LVU289
 1021 004e C363     		str	r3, [r0, #60]	@ float
 157:Core/Src/foc.c ****     controller->i_q = 0;
 1022              		.loc 1 157 5 is_stmt 1 view .LVU290
 1023              		.loc 1 157 21 is_stmt 0 view .LVU291
 1024 0050 0364     		str	r3, [r0, #64]	@ float
 158:Core/Src/foc.c ****     controller->i_q_filt = 0;
 1025              		.loc 1 158 5 is_stmt 1 view .LVU292
 1026              		.loc 1 158 26 is_stmt 0 view .LVU293
 1027 0052 4364     		str	r3, [r0, #68]	@ float
 159:Core/Src/foc.c ****     controller->q_int = 0;
 1028              		.loc 1 159 5 is_stmt 1 view .LVU294
 1029              		.loc 1 159 23 is_stmt 0 view .LVU295
 1030 0054 C0F89830 		str	r3, [r0, #152]	@ float
 160:Core/Src/foc.c ****     controller->d_int = 0;
 1031              		.loc 1 160 5 is_stmt 1 view .LVU296
 1032              		.loc 1 160 23 is_stmt 0 view .LVU297
ARM GAS  /tmp/ccXDZrk8.s 			page 22


 1033 0058 C0F89430 		str	r3, [r0, #148]	@ float
 161:Core/Src/foc.c ****     controller->v_q = 0;
 1034              		.loc 1 161 5 is_stmt 1 view .LVU298
 1035              		.loc 1 161 21 is_stmt 0 view .LVU299
 1036 005c 8365     		str	r3, [r0, #88]	@ float
 162:Core/Src/foc.c ****     controller->v_d = 0;
 1037              		.loc 1 162 5 is_stmt 1 view .LVU300
 1038              		.loc 1 162 21 is_stmt 0 view .LVU301
 1039 005e 4365     		str	r3, [r0, #84]	@ float
 163:Core/Src/foc.c ****     controller->fw_int = 0;
 1040              		.loc 1 163 5 is_stmt 1 view .LVU302
 1041              		.loc 1 163 24 is_stmt 0 view .LVU303
 1042 0060 C0F8F430 		str	r3, [r0, #244]	@ float
 164:Core/Src/foc.c ****     controller->otw_flag = 0;
 1043              		.loc 1 164 5 is_stmt 1 view .LVU304
 1044              		.loc 1 164 26 is_stmt 0 view .LVU305
 1045 0064 0023     		movs	r3, #0
 1046 0066 C0F8FC30 		str	r3, [r0, #252]
 165:Core/Src/foc.c **** 
 166:Core/Src/foc.c ****     }
 1047              		.loc 1 166 5 view .LVU306
 1048 006a 7047     		bx	lr
 1049              	.L45:
 1050              		.align	2
 1051              	.L44:
 1052 006c 00000000 		.word	htim1
 1053              		.cfi_endproc
 1054              	.LFE242:
 1056              		.section	.text.reset_observer,"ax",%progbits
 1057              		.align	1
 1058              		.global	reset_observer
 1059              		.syntax unified
 1060              		.thumb
 1061              		.thumb_func
 1062              		.fpu fpv4-sp-d16
 1064              	reset_observer:
 1065              	.LVL78:
 1066              	.LFB243:
 167:Core/Src/foc.c **** 
 168:Core/Src/foc.c **** void reset_observer(ObserverStruct *observer){
 1067              		.loc 1 168 46 is_stmt 1 view -0
 1068              		.cfi_startproc
 1069              		@ args = 0, pretend = 0, frame = 0
 1070              		@ frame_needed = 0, uses_anonymous_args = 0
 1071              		@ link register save eliminated.
 169:Core/Src/foc.c **** /*
 170:Core/Src/foc.c ****     observer->temperature = 25.0f;
 171:Core/Src/foc.c ****     observer->temp_measured = 25.0f;
 172:Core/Src/foc.c ****     //observer->resistance = .1f;
 173:Core/Src/foc.c **** */
 174:Core/Src/foc.c **** }
 1072              		.loc 1 174 1 view .LVU308
 1073 0000 7047     		bx	lr
 1074              		.cfi_endproc
 1075              	.LFE243:
 1077              		.section	.text.update_observer,"ax",%progbits
 1078              		.align	1
ARM GAS  /tmp/ccXDZrk8.s 			page 23


 1079              		.global	update_observer
 1080              		.syntax unified
 1081              		.thumb
 1082              		.thumb_func
 1083              		.fpu fpv4-sp-d16
 1085              	update_observer:
 1086              	.LVL79:
 1087              	.LFB244:
 175:Core/Src/foc.c **** 
 176:Core/Src/foc.c **** void update_observer(ControllerStruct *controller, ObserverStruct *observer)
 177:Core/Src/foc.c **** {
 1088              		.loc 1 177 1 view -0
 1089              		.cfi_startproc
 1090              		@ args = 0, pretend = 0, frame = 0
 1091              		@ frame_needed = 0, uses_anonymous_args = 0
 1092              		@ link register save eliminated.
 178:Core/Src/foc.c **** 	/*
 179:Core/Src/foc.c ****     /// Update observer estimates ///
 180:Core/Src/foc.c ****     // Resistance observer //
 181:Core/Src/foc.c ****     // Temperature Observer //
 182:Core/Src/foc.c ****     observer->delta_t = (float)observer->temperature - T_AMBIENT;
 183:Core/Src/foc.c ****     float i_sq = controller->i_d*controller->i_d + controller->i_q*controller->i_q;
 184:Core/Src/foc.c ****     observer->q_in = (R_NOMINAL*1.5f)*(1.0f + .00393f*observer->delta_t)*i_sq;
 185:Core/Src/foc.c ****     observer->q_out = observer->delta_t*R_TH;
 186:Core/Src/foc.c ****     observer->temperature += (INV_M_TH*DT)*(observer->q_in-observer->q_out);
 187:Core/Src/foc.c **** 
 188:Core/Src/foc.c ****     //float r_d = (controller->v_d*(DTC_MAX-DTC_MIN) + SQRT3*controller->dtheta_elec*(L_Q*controlle
 189:Core/Src/foc.c ****     float r_q = (controller->v_q*(DTC_MAX-DTC_MIN) - SQRT3*controller->dtheta_elec*(L_D*controller-
 190:Core/Src/foc.c ****     observer->resistance = r_q;//(r_d*controller->i_d + r_q*controller->i_q)/(controller->i_d + con
 191:Core/Src/foc.c **** 
 192:Core/Src/foc.c ****     //observer->resistance = controller->v_q/controller->i_q;
 193:Core/Src/foc.c ****     if(isnan(observer->resistance) || isinf(observer->resistance)){observer->resistance = R_NOMINAL
 194:Core/Src/foc.c ****     float t_raw = ((T_AMBIENT + ((observer->resistance/R_NOMINAL) - 1.0f)*254.5f));
 195:Core/Src/foc.c ****     if(t_raw > 200.0f){t_raw = 200.0f;}
 196:Core/Src/foc.c ****     else if(t_raw < 0.0f){t_raw = 0.0f;}
 197:Core/Src/foc.c ****     observer->temp_measured = .999f*observer->temp_measured + .001f*t_raw;
 198:Core/Src/foc.c ****     float e = (float)observer->temperature - observer->temp_measured;
 199:Core/Src/foc.c ****     observer->trust = (1.0f - .004f*fminf(abs(controller->dtheta_elec), 250.0f)) * (.01f*(fminf(i_s
 200:Core/Src/foc.c ****     observer->temperature -= observer->trust*.0001f*e;
 201:Core/Src/foc.c ****     //printf("%.3f\n\r", e);
 202:Core/Src/foc.c **** 
 203:Core/Src/foc.c ****     if(observer->temperature > TEMP_MAX){controller->otw_flag = 1;}
 204:Core/Src/foc.c ****     else{controller->otw_flag = 0;}
 205:Core/Src/foc.c ****     */
 206:Core/Src/foc.c **** }
 1093              		.loc 1 206 1 view .LVU310
 1094 0000 7047     		bx	lr
 1095              		.cfi_endproc
 1096              	.LFE244:
 1098              		.section	.text.linearize_dtc,"ax",%progbits
 1099              		.align	1
 1100              		.global	linearize_dtc
 1101              		.syntax unified
 1102              		.thumb
 1103              		.thumb_func
 1104              		.fpu fpv4-sp-d16
 1106              	linearize_dtc:
ARM GAS  /tmp/ccXDZrk8.s 			page 24


 1107              	.LVL80:
 1108              	.LFB245:
 207:Core/Src/foc.c **** 
 208:Core/Src/foc.c **** float linearize_dtc(ControllerStruct *controller, float dtc)
 209:Core/Src/foc.c **** {
 1109              		.loc 1 209 1 view -0
 1110              		.cfi_startproc
 1111              		@ args = 0, pretend = 0, frame = 0
 1112              		@ frame_needed = 0, uses_anonymous_args = 0
 1113              		.loc 1 209 1 is_stmt 0 view .LVU312
 1114 0000 10B5     		push	{r4, lr}
 1115              	.LCFI12:
 1116              		.cfi_def_cfa_offset 8
 1117              		.cfi_offset 4, -8
 1118              		.cfi_offset 14, -4
 1119 0002 0446     		mov	r4, r0
 210:Core/Src/foc.c ****     float duty = fast_fmaxf(fast_fminf(fabs(dtc), .999f), 0.0f);;
 1120              		.loc 1 210 5 is_stmt 1 view .LVU313
 1121              		.loc 1 210 18 is_stmt 0 view .LVU314
 1122 0004 DFED170A 		vldr.32	s1, .L50
 1123 0008 B0EEC00A 		vabs.f32	s0, s0
 1124              	.LVL81:
 1125              		.loc 1 210 18 view .LVU315
 1126 000c FFF7FEFF 		bl	fast_fminf
 1127              	.LVL82:
 1128              		.loc 1 210 18 view .LVU316
 1129 0010 DFED150A 		vldr.32	s1, .L50+4
 1130 0014 FFF7FEFF 		bl	fast_fmaxf
 1131              	.LVL83:
 1132              		.loc 1 210 65 is_stmt 1 view .LVU317
 211:Core/Src/foc.c ****     int index = (int) (duty*127.0f);
 1133              		.loc 1 211 5 view .LVU318
 1134              		.loc 1 211 28 is_stmt 0 view .LVU319
 1135 0018 9FED147A 		vldr.32	s14, .L50+8
 1136 001c 20EE077A 		vmul.f32	s14, s0, s14
 1137              		.loc 1 211 9 view .LVU320
 1138 0020 FDEEC77A 		vcvt.s32.f32	s15, s14
 1139 0024 17EE903A 		vmov	r3, s15	@ int
 1140              	.LVL84:
 212:Core/Src/foc.c ****     float val1 = controller->inverter_tab[index];
 1141              		.loc 1 212 5 is_stmt 1 view .LVU321
 1142              		.loc 1 212 11 is_stmt 0 view .LVU322
 1143 0028 03F14002 		add	r2, r3, #64
 1144 002c 04EB8202 		add	r2, r4, r2, lsl #2
 1145 0030 D2ED016A 		vldr.32	s13, [r2, #4]
 1146              	.LVL85:
 213:Core/Src/foc.c ****     float val2 = controller->inverter_tab[index+1];
 1147              		.loc 1 213 5 is_stmt 1 view .LVU323
 1148              		.loc 1 213 11 is_stmt 0 view .LVU324
 1149 0034 03F14100 		add	r0, r3, #65
 1150 0038 04EB8004 		add	r4, r4, r0, lsl #2
 1151              	.LVL86:
 1152              		.loc 1 213 11 view .LVU325
 1153 003c D4ED017A 		vldr.32	s15, [r4, #4]
 1154              	.LVL87:
 214:Core/Src/foc.c ****     return val1 + (val2 - val1)*(duty*128.0f - (float)index);
 1155              		.loc 1 214 5 is_stmt 1 view .LVU326
ARM GAS  /tmp/ccXDZrk8.s 			page 25


 1156              		.loc 1 214 25 is_stmt 0 view .LVU327
 1157 0040 37EEE67A 		vsub.f32	s14, s15, s13
 1158              		.loc 1 214 38 view .LVU328
 1159 0044 DFED0A7A 		vldr.32	s15, .L50+12
 1160              	.LVL88:
 1161              		.loc 1 214 38 view .LVU329
 1162 0048 20EE270A 		vmul.f32	s0, s0, s15
 1163              	.LVL89:
 1164              		.loc 1 214 48 view .LVU330
 1165 004c 07EE903A 		vmov	s15, r3	@ int
 1166 0050 F8EEE77A 		vcvt.f32.s32	s15, s15
 1167              		.loc 1 214 46 view .LVU331
 1168 0054 70EE677A 		vsub.f32	s15, s0, s15
 1169              		.loc 1 214 32 view .LVU332
 1170 0058 67EE277A 		vmul.f32	s15, s14, s15
 215:Core/Src/foc.c **** }
 1171              		.loc 1 215 1 view .LVU333
 1172 005c 37EEA60A 		vadd.f32	s0, s15, s13
 1173 0060 10BD     		pop	{r4, pc}
 1174              	.LVL90:
 1175              	.L51:
 1176              		.loc 1 215 1 view .LVU334
 1177 0062 00BF     		.align	2
 1178              	.L50:
 1179 0064 77BE7F3F 		.word	1065336439
 1180 0068 00000000 		.word	0
 1181 006c 0000FE42 		.word	1123942400
 1182 0070 00000043 		.word	1124073472
 1183              		.cfi_endproc
 1184              	.LFE245:
 1186              		.section	.text.field_weaken,"ax",%progbits
 1187              		.align	1
 1188              		.global	field_weaken
 1189              		.syntax unified
 1190              		.thumb
 1191              		.thumb_func
 1192              		.fpu fpv4-sp-d16
 1194              	field_weaken:
 1195              	.LVL91:
 1196              	.LFB246:
 216:Core/Src/foc.c **** 
 217:Core/Src/foc.c **** void field_weaken(ControllerStruct *controller)
 218:Core/Src/foc.c **** {
 1197              		.loc 1 218 1 is_stmt 1 view -0
 1198              		.cfi_startproc
 1199              		@ args = 0, pretend = 0, frame = 0
 1200              		@ frame_needed = 0, uses_anonymous_args = 0
 1201              		.loc 1 218 1 is_stmt 0 view .LVU336
 1202 0000 10B5     		push	{r4, lr}
 1203              	.LCFI13:
 1204              		.cfi_def_cfa_offset 8
 1205              		.cfi_offset 4, -8
 1206              		.cfi_offset 14, -4
 1207 0002 2DED028B 		vpush.64	{d8}
 1208              	.LCFI14:
 1209              		.cfi_def_cfa_offset 16
 1210              		.cfi_offset 80, -16
ARM GAS  /tmp/ccXDZrk8.s 			page 26


 1211              		.cfi_offset 81, -12
 1212 0006 0446     		mov	r4, r0
 219:Core/Src/foc.c ****        /// Field Weakening ///
 220:Core/Src/foc.c **** 
 221:Core/Src/foc.c ****        controller->fw_int += controller->ki_fw*(controller->v_max - 1.0f - controller->v_ref);
 1213              		.loc 1 221 8 is_stmt 1 view .LVU337
 1214              		.loc 1 221 40 is_stmt 0 view .LVU338
 1215 0008 90ED220A 		vldr.32	s0, [r0, #136]
 1216              		.loc 1 221 59 view .LVU339
 1217 000c D0ED3B7A 		vldr.32	s15, [r0, #236]
 1218              		.loc 1 221 67 view .LVU340
 1219 0010 B7EE007A 		vmov.f32	s14, #1.0e+0
 1220 0014 77EEC77A 		vsub.f32	s15, s15, s14
 1221              		.loc 1 221 86 view .LVU341
 1222 0018 90ED3C7A 		vldr.32	s14, [r0, #240]
 1223              		.loc 1 221 74 view .LVU342
 1224 001c 77EEC77A 		vsub.f32	s15, s15, s14
 1225              		.loc 1 221 47 view .LVU343
 1226 0020 20EE270A 		vmul.f32	s0, s0, s15
 1227              		.loc 1 221 27 view .LVU344
 1228 0024 D0ED3D7A 		vldr.32	s15, [r0, #244]
 1229 0028 30EE270A 		vadd.f32	s0, s0, s15
 1230 002c 80ED3D0A 		vstr.32	s0, [r0, #244]
 222:Core/Src/foc.c ****        controller->fw_int = fast_fmaxf(fast_fminf(controller->fw_int, 0.0f), -I_FW_MAX);
 1231              		.loc 1 222 8 is_stmt 1 view .LVU345
 1232              		.loc 1 222 29 is_stmt 0 view .LVU346
 1233 0030 DFED240A 		vldr.32	s1, .L65
 1234 0034 FFF7FEFF 		bl	fast_fminf
 1235              	.LVL92:
 1236              		.loc 1 222 79 view .LVU347
 1237 0038 234B     		ldr	r3, .L65+4
 1238 003a D3ED060A 		vldr.32	s1, [r3, #24]
 1239              		.loc 1 222 29 view .LVU348
 1240 003e F1EE600A 		vneg.f32	s1, s1
 1241 0042 FFF7FEFF 		bl	fast_fmaxf
 1242              	.LVL93:
 1243              		.loc 1 222 27 view .LVU349
 1244 0046 84ED3D0A 		vstr.32	s0, [r4, #244]
 223:Core/Src/foc.c ****        controller->i_q_des = controller->i_q_des + (controller->i_q_des > 0)*controller->fw_int + (
 1245              		.loc 1 223 8 is_stmt 1 view .LVU350
 1246              		.loc 1 223 40 is_stmt 0 view .LVU351
 1247 004a 94ED2C7A 		vldr.32	s14, [r4, #176]
 1248              		.loc 1 223 77 view .LVU352
 1249 004e B5EEC07A 		vcmpe.f32	s14, #0
 1250 0052 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1251 0056 2FDD     		ble	.L61
 1252 0058 F7EE007A 		vmov.f32	s15, #1.0e+0
 1253              	.L53:
 1254              		.loc 1 223 77 discriminator 4 view .LVU353
 1255 005c 60EE277A 		vmul.f32	s15, s0, s15
 1256              		.loc 1 223 50 discriminator 4 view .LVU354
 1257 0060 77EE277A 		vadd.f32	s15, s14, s15
 1258              		.loc 1 223 124 discriminator 4 view .LVU355
 1259 0064 B5EEC07A 		vcmpe.f32	s14, #0
 1260 0068 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1261 006c 27D4     		bmi	.L64
 1262              		.loc 1 223 124 view .LVU356
ARM GAS  /tmp/ccXDZrk8.s 			page 27


 1263 006e 9FED157A 		vldr.32	s14, .L65
 1264              	.L55:
 1265              		.loc 1 223 124 discriminator 8 view .LVU357
 1266 0072 20EE077A 		vmul.f32	s14, s0, s14
 1267              		.loc 1 223 97 discriminator 8 view .LVU358
 1268 0076 77EE877A 		vadd.f32	s15, s15, s14
 1269              		.loc 1 223 28 discriminator 8 view .LVU359
 1270 007a C4ED2C7A 		vstr.32	s15, [r4, #176]
 224:Core/Src/foc.c ****        controller->i_d_des = controller->fw_int;
 1271              		.loc 1 224 8 is_stmt 1 discriminator 8 view .LVU360
 1272              		.loc 1 224 28 is_stmt 0 discriminator 8 view .LVU361
 1273 007e 84ED2B0A 		vstr.32	s0, [r4, #172]
 225:Core/Src/foc.c ****        float q_max = sqrtf(controller->i_max*controller->i_max - controller->i_d_des*controller->i_
 1274              		.loc 1 225 8 is_stmt 1 discriminator 8 view .LVU362
 1275              		.loc 1 225 38 is_stmt 0 discriminator 8 view .LVU363
 1276 0082 D4ED407A 		vldr.32	s15, [r4, #256]
 1277              		.loc 1 225 45 discriminator 8 view .LVU364
 1278 0086 67EEA77A 		vmul.f32	s15, s15, s15
 1279              		.loc 1 225 85 discriminator 8 view .LVU365
 1280 008a 20EE000A 		vmul.f32	s0, s0, s0
 1281              		.loc 1 225 22 discriminator 8 view .LVU366
 1282 008e 37EEC00A 		vsub.f32	s0, s15, s0
 1283 0092 FFF7FEFF 		bl	sqrtf
 1284              	.LVL94:
 1285 0096 B0EE408A 		vmov.f32	s16, s0
 1286              	.LVL95:
 226:Core/Src/foc.c ****        controller->i_q_des = fast_fmaxf(fast_fminf(controller->i_q_des, q_max), -q_max);
 1287              		.loc 1 226 8 is_stmt 1 discriminator 8 view .LVU367
 1288              		.loc 1 226 30 is_stmt 0 discriminator 8 view .LVU368
 1289 009a F0EE400A 		vmov.f32	s1, s0
 1290 009e 94ED2C0A 		vldr.32	s0, [r4, #176]
 1291              	.LVL96:
 1292              		.loc 1 226 30 discriminator 8 view .LVU369
 1293 00a2 FFF7FEFF 		bl	fast_fminf
 1294              	.LVL97:
 1295              		.loc 1 226 30 discriminator 8 view .LVU370
 1296 00a6 F1EE480A 		vneg.f32	s1, s16
 1297 00aa FFF7FEFF 		bl	fast_fmaxf
 1298              	.LVL98:
 1299              		.loc 1 226 28 discriminator 8 view .LVU371
 1300 00ae 84ED2C0A 		vstr.32	s0, [r4, #176]
 227:Core/Src/foc.c **** 
 228:Core/Src/foc.c **** 
 229:Core/Src/foc.c **** }
 1301              		.loc 1 229 1 discriminator 8 view .LVU372
 1302 00b2 BDEC028B 		vldm	sp!, {d8}
 1303              	.LCFI15:
 1304              		.cfi_remember_state
 1305              		.cfi_restore 80
 1306              		.cfi_restore 81
 1307              		.cfi_def_cfa_offset 8
 1308              	.LVL99:
 1309              		.loc 1 229 1 discriminator 8 view .LVU373
 1310 00b6 10BD     		pop	{r4, pc}
 1311              	.LVL100:
 1312              	.L61:
 1313              	.LCFI16:
ARM GAS  /tmp/ccXDZrk8.s 			page 28


 1314              		.cfi_restore_state
 223:Core/Src/foc.c ****        controller->i_d_des = controller->fw_int;
 1315              		.loc 1 223 77 view .LVU374
 1316 00b8 DFED027A 		vldr.32	s15, .L65
 1317 00bc CEE7     		b	.L53
 1318              	.L64:
 223:Core/Src/foc.c ****        controller->i_d_des = controller->fw_int;
 1319              		.loc 1 223 124 view .LVU375
 1320 00be B7EE007A 		vmov.f32	s14, #1.0e+0
 1321 00c2 D6E7     		b	.L55
 1322              	.L66:
 1323              		.align	2
 1324              	.L65:
 1325 00c4 00000000 		.word	0
 1326 00c8 00000000 		.word	__float_reg
 1327              		.cfi_endproc
 1328              	.LFE246:
 1330              		.section	.text.commutate,"ax",%progbits
 1331              		.align	1
 1332              		.global	commutate
 1333              		.syntax unified
 1334              		.thumb
 1335              		.thumb_func
 1336              		.fpu fpv4-sp-d16
 1338              	commutate:
 1339              	.LVL101:
 1340              	.LFB247:
 230:Core/Src/foc.c **** void commutate(ControllerStruct *controller, EncoderStruct *encoder)
 231:Core/Src/foc.c **** {
 1341              		.loc 1 231 1 is_stmt 1 view -0
 1342              		.cfi_startproc
 1343              		@ args = 0, pretend = 0, frame = 0
 1344              		@ frame_needed = 0, uses_anonymous_args = 0
 1345              		.loc 1 231 1 is_stmt 0 view .LVU377
 1346 0000 38B5     		push	{r3, r4, r5, lr}
 1347              	.LCFI17:
 1348              		.cfi_def_cfa_offset 16
 1349              		.cfi_offset 3, -16
 1350              		.cfi_offset 4, -12
 1351              		.cfi_offset 5, -8
 1352              		.cfi_offset 14, -4
 1353 0002 2DED048B 		vpush.64	{d8, d9}
 1354              	.LCFI18:
 1355              		.cfi_def_cfa_offset 32
 1356              		.cfi_offset 80, -32
 1357              		.cfi_offset 81, -28
 1358              		.cfi_offset 82, -24
 1359              		.cfi_offset 83, -20
 1360 0006 0446     		mov	r4, r0
 232:Core/Src/foc.c **** 	/* Do Field Oriented Control */
 233:Core/Src/foc.c **** 
 234:Core/Src/foc.c **** 		controller->theta_elec = encoder->elec_angle;
 1361              		.loc 1 234 3 is_stmt 1 view .LVU378
 1362              		.loc 1 234 35 is_stmt 0 view .LVU379
 1363 0008 91ED170A 		vldr.32	s0, [r1, #92]
 1364              		.loc 1 234 26 view .LVU380
 1365 000c 80ED0B0A 		vstr.32	s0, [r0, #44]
ARM GAS  /tmp/ccXDZrk8.s 			page 29


 235:Core/Src/foc.c **** 		controller->dtheta_elec = encoder->elec_velocity;
 1366              		.loc 1 235 3 is_stmt 1 view .LVU381
 1367              		.loc 1 235 36 is_stmt 0 view .LVU382
 1368 0010 4B6E     		ldr	r3, [r1, #100]	@ float
 1369              		.loc 1 235 27 view .LVU383
 1370 0012 4363     		str	r3, [r0, #52]	@ float
 236:Core/Src/foc.c **** 		controller->dtheta_mech = encoder->velocity/GR;
 1371              		.loc 1 236 3 is_stmt 1 view .LVU384
 1372              		.loc 1 236 36 is_stmt 0 view .LVU385
 1373 0014 D1ED186A 		vldr.32	s13, [r1, #96]
 1374              		.loc 1 236 47 view .LVU386
 1375 0018 8B4D     		ldr	r5, .L72
 1376 001a 95ED117A 		vldr.32	s14, [r5, #68]
 1377              		.loc 1 236 46 view .LVU387
 1378 001e C6EE877A 		vdiv.f32	s15, s13, s14
 1379              		.loc 1 236 27 view .LVU388
 1380 0022 C0ED0C7A 		vstr.32	s15, [r0, #48]
 237:Core/Src/foc.c **** 		controller->theta_mech = encoder->angle_multiturn[0]/GR;
 1381              		.loc 1 237 3 is_stmt 1 view .LVU389
 1382              		.loc 1 237 52 is_stmt 0 view .LVU390
 1383 0026 D1ED036A 		vldr.32	s13, [r1, #12]
 1384              		.loc 1 237 56 view .LVU391
 1385 002a 95ED117A 		vldr.32	s14, [r5, #68]
 1386              		.loc 1 237 55 view .LVU392
 1387 002e C6EE877A 		vdiv.f32	s15, s13, s14
 1388              		.loc 1 237 26 view .LVU393
 1389 0032 C0ED0A7A 		vstr.32	s15, [r0, #40]
 238:Core/Src/foc.c **** 
 239:Core/Src/foc.c ****        /// Commutation  ///
 240:Core/Src/foc.c ****        dq0(controller->theta_elec, controller->i_a, controller->i_b, controller->i_c, &controller->
 1390              		.loc 1 240 8 is_stmt 1 view .LVU394
 1391 0036 00F14001 		add	r1, r0, #64
 1392              	.LVL102:
 1393              		.loc 1 240 8 is_stmt 0 view .LVU395
 1394 003a 3C30     		adds	r0, r0, #60
 1395              	.LVL103:
 1396              		.loc 1 240 8 view .LVU396
 1397 003c D4ED071A 		vldr.32	s3, [r4, #28]
 1398 0040 94ED061A 		vldr.32	s2, [r4, #24]
 1399 0044 D4ED050A 		vldr.32	s1, [r4, #20]
 1400 0048 FFF7FEFF 		bl	dq0
 1401              	.LVL104:
 241:Core/Src/foc.c **** 
 242:Core/Src/foc.c ****        controller->i_q_filt = (1.0f-CURRENT_FILT_ALPHA)*controller->i_q_filt + CURRENT_FILT_ALPHA*c
 1402              		.loc 1 242 8 is_stmt 1 view .LVU397
 1403              		.loc 1 242 67 is_stmt 0 view .LVU398
 1404 004c 94ED117A 		vldr.32	s14, [r4, #68]
 1405              		.loc 1 242 56 view .LVU399
 1406 0050 9FED7E6A 		vldr.32	s12, .L72+4
 1407 0054 27EE067A 		vmul.f32	s14, s14, s12
 1408              		.loc 1 242 109 view .LVU400
 1409 0058 D4ED107A 		vldr.32	s15, [r4, #64]
 1410              		.loc 1 242 98 view .LVU401
 1411 005c DFED7C6A 		vldr.32	s13, .L72+8
 1412 0060 67EEA67A 		vmul.f32	s15, s15, s13
 1413              		.loc 1 242 78 view .LVU402
 1414 0064 37EE277A 		vadd.f32	s14, s14, s15
ARM GAS  /tmp/ccXDZrk8.s 			page 30


 1415              		.loc 1 242 29 view .LVU403
 1416 0068 84ED117A 		vstr.32	s14, [r4, #68]
 243:Core/Src/foc.c ****        controller->i_d_filt = (1.0f-CURRENT_FILT_ALPHA)*controller->i_d_filt + CURRENT_FILT_ALPHA*c
 1417              		.loc 1 243 8 is_stmt 1 view .LVU404
 1418              		.loc 1 243 67 is_stmt 0 view .LVU405
 1419 006c 94ED127A 		vldr.32	s14, [r4, #72]
 1420              		.loc 1 243 56 view .LVU406
 1421 0070 27EE067A 		vmul.f32	s14, s14, s12
 1422              		.loc 1 243 109 view .LVU407
 1423 0074 D4ED0F7A 		vldr.32	s15, [r4, #60]
 1424              		.loc 1 243 98 view .LVU408
 1425 0078 67EEA67A 		vmul.f32	s15, s15, s13
 1426              		.loc 1 243 78 view .LVU409
 1427 007c 37EE277A 		vadd.f32	s14, s14, s15
 1428              		.loc 1 243 29 view .LVU410
 1429 0080 84ED127A 		vstr.32	s14, [r4, #72]
 244:Core/Src/foc.c ****        controller->v_bus_filt = (1.0f-VBUS_FILT_ALPHA)*controller->v_bus_filt + VBUS_FILT_ALPHA*con
 1430              		.loc 1 244 8 is_stmt 1 view .LVU411
 1431              		.loc 1 244 66 is_stmt 0 view .LVU412
 1432 0084 D4ED097A 		vldr.32	s15, [r4, #36]
 1433              		.loc 1 244 55 view .LVU413
 1434 0088 67EE867A 		vmul.f32	s15, s15, s12
 1435              		.loc 1 244 107 view .LVU414
 1436 008c 94ED087A 		vldr.32	s14, [r4, #32]
 1437              		.loc 1 244 96 view .LVU415
 1438 0090 27EE267A 		vmul.f32	s14, s14, s13
 1439              		.loc 1 244 79 view .LVU416
 1440 0094 77EE877A 		vadd.f32	s15, s15, s14
 1441              		.loc 1 244 31 view .LVU417
 1442 0098 C4ED097A 		vstr.32	s15, [r4, #36]
 245:Core/Src/foc.c **** 
 246:Core/Src/foc.c ****        controller->v_max = OVERMODULATION*controller->v_bus_filt*(DTC_MAX-DTC_MIN)*SQRT1_3;
 1443              		.loc 1 246 8 is_stmt 1 view .LVU418
 1444              		.loc 1 246 65 is_stmt 0 view .LVU419
 1445 009c 9FED6D7A 		vldr.32	s14, .L72+12
 1446 00a0 67EE877A 		vmul.f32	s15, s15, s14
 1447              		.loc 1 246 83 view .LVU420
 1448 00a4 9FED6C7A 		vldr.32	s14, .L72+16
 1449 00a8 67EE877A 		vmul.f32	s15, s15, s14
 1450              		.loc 1 246 26 view .LVU421
 1451 00ac C4ED3B7A 		vstr.32	s15, [r4, #236]
 247:Core/Src/foc.c ****        controller->v_margin = controller->v_max - controller->v_ref;
 1452              		.loc 1 247 8 is_stmt 1 view .LVU422
 1453              		.loc 1 247 61 is_stmt 0 view .LVU423
 1454 00b0 94ED3C7A 		vldr.32	s14, [r4, #240]
 1455              		.loc 1 247 49 view .LVU424
 1456 00b4 77EEC77A 		vsub.f32	s15, s15, s14
 1457              		.loc 1 247 29 view .LVU425
 1458 00b8 C4ED3E7A 		vstr.32	s15, [r4, #248]
 248:Core/Src/foc.c ****        controller->i_max = I_MAX; //I_MAX*(!controller->otw_flag) + I_MAX_CONT*controller->otw_flag
 1459              		.loc 1 248 8 is_stmt 1 view .LVU426
 1460              		.loc 1 248 28 is_stmt 0 view .LVU427
 1461 00bc 95ED030A 		vldr.32	s0, [r5, #12]
 1462              		.loc 1 248 26 view .LVU428
 1463 00c0 84ED400A 		vstr.32	s0, [r4, #256]
 249:Core/Src/foc.c **** 
 250:Core/Src/foc.c ****        limit_norm(&controller->i_d_des, &controller->i_q_des, controller->i_max);	// 2.3 us
ARM GAS  /tmp/ccXDZrk8.s 			page 31


 1464              		.loc 1 250 8 is_stmt 1 view .LVU429
 1465 00c4 04F1B001 		add	r1, r4, #176
 1466 00c8 04F1AC00 		add	r0, r4, #172
 1467 00cc FFF7FEFF 		bl	limit_norm
 1468              	.LVL105:
 251:Core/Src/foc.c **** 
 252:Core/Src/foc.c ****        /// PI Controller ///
 253:Core/Src/foc.c ****        float i_d_error = controller->i_d_des - controller->i_d;
 1469              		.loc 1 253 8 view .LVU430
 1470              		.loc 1 253 36 is_stmt 0 view .LVU431
 1471 00d0 94ED2B0A 		vldr.32	s0, [r4, #172]
 1472              		.loc 1 253 58 view .LVU432
 1473 00d4 D4ED0F8A 		vldr.32	s17, [r4, #60]
 1474              		.loc 1 253 14 view .LVU433
 1475 00d8 70EE688A 		vsub.f32	s17, s0, s17
 1476              	.LVL106:
 254:Core/Src/foc.c ****        float i_q_error = controller->i_q_des - controller->i_q;
 1477              		.loc 1 254 8 is_stmt 1 view .LVU434
 1478              		.loc 1 254 36 is_stmt 0 view .LVU435
 1479 00dc D4ED2C7A 		vldr.32	s15, [r4, #176]
 1480              		.loc 1 254 58 view .LVU436
 1481 00e0 94ED107A 		vldr.32	s14, [r4, #64]
 1482              		.loc 1 254 14 view .LVU437
 1483 00e4 37EEC78A 		vsub.f32	s16, s15, s14
 1484              	.LVL107:
 255:Core/Src/foc.c **** 
 256:Core/Src/foc.c ****        if(controller->i_q > controller->i_mag_max){
 1485              		.loc 1 256 8 is_stmt 1 view .LVU438
 1486              		.loc 1 256 39 is_stmt 0 view .LVU439
 1487 00e8 D4ED147A 		vldr.32	s15, [r4, #80]
 1488              		.loc 1 256 10 view .LVU440
 1489 00ec B4EEE77A 		vcmpe.f32	s14, s15
 1490 00f0 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1491 00f4 01DD     		ble	.L68
 257:Core/Src/foc.c ****     	   controller->i_mag_max = controller->i_q;
 1492              		.loc 1 257 9 is_stmt 1 view .LVU441
 1493              		.loc 1 257 31 is_stmt 0 view .LVU442
 1494 00f6 84ED147A 		vstr.32	s14, [r4, #80]
 1495              	.L68:
 258:Core/Src/foc.c ****        }
 259:Core/Src/foc.c **** 
 260:Core/Src/foc.c **** 
 261:Core/Src/foc.c ****        // Calculate decoupling feed-forward voltages //
 262:Core/Src/foc.c **** 
 263:Core/Src/foc.c ****        float v_d_ff = 0.0f;//-SQRT3*controller->dtheta_elec*L_Q*controller->i_q;
 1496              		.loc 1 263 8 is_stmt 1 view .LVU443
 1497              	.LVL108:
 264:Core/Src/foc.c ****        float v_q_ff = 0.0f;//SQRT3*controller->dtheta_elec*(0.0f*L_D*controller->i_d + controller->
 1498              		.loc 1 264 8 view .LVU444
 265:Core/Src/foc.c **** 
 266:Core/Src/foc.c ****        controller->v_d = controller->k_d*i_d_error + controller->d_int + v_d_ff;
 1499              		.loc 1 266 8 view .LVU445
 1500              		.loc 1 266 36 is_stmt 0 view .LVU446
 1501 00fa 94ED1E0A 		vldr.32	s0, [r4, #120]
 1502              		.loc 1 266 41 view .LVU447
 1503 00fe 20EE280A 		vmul.f32	s0, s0, s17
 1504              		.loc 1 266 64 view .LVU448
ARM GAS  /tmp/ccXDZrk8.s 			page 32


 1505 0102 D4ED257A 		vldr.32	s15, [r4, #148]
 1506              		.loc 1 266 52 view .LVU449
 1507 0106 30EE270A 		vadd.f32	s0, s0, s15
 1508              		.loc 1 266 72 view .LVU450
 1509 010a 9FED549A 		vldr.32	s18, .L72+20
 1510 010e 30EE090A 		vadd.f32	s0, s0, s18
 1511              		.loc 1 266 24 view .LVU451
 1512 0112 84ED150A 		vstr.32	s0, [r4, #84]
 267:Core/Src/foc.c **** 
 268:Core/Src/foc.c ****        controller->v_d = fast_fmaxf(fast_fminf(controller->v_d, controller->v_max), -controller->v_
 1513              		.loc 1 268 8 is_stmt 1 view .LVU452
 1514              		.loc 1 268 26 is_stmt 0 view .LVU453
 1515 0116 D4ED3B0A 		vldr.32	s1, [r4, #236]
 1516 011a FFF7FEFF 		bl	fast_fminf
 1517              	.LVL109:
 1518              		.loc 1 268 96 view .LVU454
 1519 011e D4ED3B0A 		vldr.32	s1, [r4, #236]
 1520              		.loc 1 268 26 view .LVU455
 1521 0122 F1EE600A 		vneg.f32	s1, s1
 1522 0126 FFF7FEFF 		bl	fast_fmaxf
 1523              	.LVL110:
 1524              		.loc 1 268 24 view .LVU456
 1525 012a 84ED150A 		vstr.32	s0, [r4, #84]
 269:Core/Src/foc.c **** 
 270:Core/Src/foc.c ****        controller->d_int += controller->k_d*controller->ki_d*i_d_error;
 1526              		.loc 1 270 8 is_stmt 1 view .LVU457
 1527              		.loc 1 270 39 is_stmt 0 view .LVU458
 1528 012e 94ED1E0A 		vldr.32	s0, [r4, #120]
 1529              		.loc 1 270 55 view .LVU459
 1530 0132 D4ED207A 		vldr.32	s15, [r4, #128]
 1531              		.loc 1 270 44 view .LVU460
 1532 0136 20EE270A 		vmul.f32	s0, s0, s15
 1533              		.loc 1 270 61 view .LVU461
 1534 013a 20EE280A 		vmul.f32	s0, s0, s17
 1535              		.loc 1 270 26 view .LVU462
 1536 013e D4ED257A 		vldr.32	s15, [r4, #148]
 1537 0142 30EE270A 		vadd.f32	s0, s0, s15
 1538 0146 84ED250A 		vstr.32	s0, [r4, #148]
 271:Core/Src/foc.c ****        controller->d_int = fast_fmaxf(fast_fminf(controller->d_int, controller->v_max), -controller
 1539              		.loc 1 271 8 is_stmt 1 view .LVU463
 1540              		.loc 1 271 28 is_stmt 0 view .LVU464
 1541 014a D4ED3B0A 		vldr.32	s1, [r4, #236]
 1542 014e FFF7FEFF 		bl	fast_fminf
 1543              	.LVL111:
 1544              		.loc 1 271 100 view .LVU465
 1545 0152 D4ED3B0A 		vldr.32	s1, [r4, #236]
 1546              		.loc 1 271 28 view .LVU466
 1547 0156 F1EE600A 		vneg.f32	s1, s1
 1548 015a FFF7FEFF 		bl	fast_fmaxf
 1549              	.LVL112:
 1550              		.loc 1 271 26 view .LVU467
 1551 015e 84ED250A 		vstr.32	s0, [r4, #148]
 272:Core/Src/foc.c ****        float vq_max = controller->v_max;//sqrtf(controller->v_max*controller->v_max - controller->v
 1552              		.loc 1 272 8 is_stmt 1 view .LVU468
 1553              		.loc 1 272 14 is_stmt 0 view .LVU469
 1554 0162 D4ED3B8A 		vldr.32	s17, [r4, #236]
 1555              	.LVL113:
ARM GAS  /tmp/ccXDZrk8.s 			page 33


 273:Core/Src/foc.c **** 
 274:Core/Src/foc.c ****        controller->v_q = controller->k_q*i_q_error + controller->q_int + v_q_ff;
 1556              		.loc 1 274 8 is_stmt 1 view .LVU470
 1557              		.loc 1 274 36 is_stmt 0 view .LVU471
 1558 0166 D4ED1F7A 		vldr.32	s15, [r4, #124]
 1559              		.loc 1 274 41 view .LVU472
 1560 016a 27EE887A 		vmul.f32	s14, s15, s16
 1561              		.loc 1 274 64 view .LVU473
 1562 016e 94ED260A 		vldr.32	s0, [r4, #152]
 1563              		.loc 1 274 52 view .LVU474
 1564 0172 37EE007A 		vadd.f32	s14, s14, s0
 1565              		.loc 1 274 72 view .LVU475
 1566 0176 37EE097A 		vadd.f32	s14, s14, s18
 1567              		.loc 1 274 24 view .LVU476
 1568 017a 84ED167A 		vstr.32	s14, [r4, #88]
 275:Core/Src/foc.c ****        controller->q_int += controller->k_q*controller->ki_q*i_q_error;
 1569              		.loc 1 275 8 is_stmt 1 view .LVU477
 1570              		.loc 1 275 55 is_stmt 0 view .LVU478
 1571 017e 94ED217A 		vldr.32	s14, [r4, #132]
 1572              		.loc 1 275 44 view .LVU479
 1573 0182 67EE877A 		vmul.f32	s15, s15, s14
 1574              		.loc 1 275 61 view .LVU480
 1575 0186 67EE887A 		vmul.f32	s15, s15, s16
 1576              		.loc 1 275 26 view .LVU481
 1577 018a 30EE270A 		vadd.f32	s0, s0, s15
 1578 018e 84ED260A 		vstr.32	s0, [r4, #152]
 276:Core/Src/foc.c ****        controller->q_int = fast_fmaxf(fast_fminf(controller->q_int, controller->v_max), -controller
 1579              		.loc 1 276 8 is_stmt 1 view .LVU482
 1580              		.loc 1 276 28 is_stmt 0 view .LVU483
 1581 0192 F0EE680A 		vmov.f32	s1, s17
 1582 0196 FFF7FEFF 		bl	fast_fminf
 1583              	.LVL114:
 1584              		.loc 1 276 100 view .LVU484
 1585 019a D4ED3B0A 		vldr.32	s1, [r4, #236]
 1586              		.loc 1 276 28 view .LVU485
 1587 019e F1EE600A 		vneg.f32	s1, s1
 1588 01a2 FFF7FEFF 		bl	fast_fmaxf
 1589              	.LVL115:
 1590              		.loc 1 276 26 view .LVU486
 1591 01a6 84ED260A 		vstr.32	s0, [r4, #152]
 277:Core/Src/foc.c ****        controller->v_ref = sqrtf(controller->v_d*controller->v_d + controller->v_q*controller->v_q)
 1592              		.loc 1 277 8 is_stmt 1 view .LVU487
 1593              		.loc 1 277 44 is_stmt 0 view .LVU488
 1594 01aa 94ED150A 		vldr.32	s0, [r4, #84]
 1595              		.loc 1 277 49 view .LVU489
 1596 01ae 20EE000A 		vmul.f32	s0, s0, s0
 1597              		.loc 1 277 78 view .LVU490
 1598 01b2 D4ED167A 		vldr.32	s15, [r4, #88]
 1599              		.loc 1 277 83 view .LVU491
 1600 01b6 67EEA77A 		vmul.f32	s15, s15, s15
 1601              		.loc 1 277 28 view .LVU492
 1602 01ba 30EE270A 		vadd.f32	s0, s0, s15
 1603 01be FFF7FEFF 		bl	sqrtf
 1604              	.LVL116:
 1605              		.loc 1 277 26 view .LVU493
 1606 01c2 84ED3C0A 		vstr.32	s0, [r4, #240]
 278:Core/Src/foc.c ****        controller->v_q = fast_fmaxf(fast_fminf(controller->v_q, vq_max), -vq_max);
ARM GAS  /tmp/ccXDZrk8.s 			page 34


 1607              		.loc 1 278 8 is_stmt 1 view .LVU494
 1608              		.loc 1 278 26 is_stmt 0 view .LVU495
 1609 01c6 F0EE680A 		vmov.f32	s1, s17
 1610 01ca 94ED160A 		vldr.32	s0, [r4, #88]
 1611 01ce FFF7FEFF 		bl	fast_fminf
 1612              	.LVL117:
 1613 01d2 F1EE680A 		vneg.f32	s1, s17
 1614 01d6 FFF7FEFF 		bl	fast_fmaxf
 1615              	.LVL118:
 1616              		.loc 1 278 24 view .LVU496
 1617 01da 84ED160A 		vstr.32	s0, [r4, #88]
 279:Core/Src/foc.c **** 
 280:Core/Src/foc.c ****        limit_norm(&controller->v_d, &controller->v_q, controller->v_max);
 1618              		.loc 1 280 8 is_stmt 1 view .LVU497
 1619 01de 94ED3B0A 		vldr.32	s0, [r4, #236]
 1620 01e2 04F15801 		add	r1, r4, #88
 1621 01e6 04F15400 		add	r0, r4, #84
 1622 01ea FFF7FEFF 		bl	limit_norm
 1623              	.LVL119:
 281:Core/Src/foc.c **** 
 282:Core/Src/foc.c ****        abc(controller->theta_elec + 1.5f*DT*controller->dtheta_elec, controller->v_d, controller->v
 1624              		.loc 1 282 8 view .LVU498
 1625              		.loc 1 282 22 is_stmt 0 view .LVU499
 1626 01ee 94ED0B0A 		vldr.32	s0, [r4, #44]
 1627              		.loc 1 282 55 view .LVU500
 1628 01f2 D4ED0D7A 		vldr.32	s15, [r4, #52]
 1629              		.loc 1 282 44 view .LVU501
 1630 01f6 9FED1A7A 		vldr.32	s14, .L72+24
 1631 01fa 67EE877A 		vmul.f32	s15, s15, s14
 1632              		.loc 1 282 8 view .LVU502
 1633 01fe 04F17002 		add	r2, r4, #112
 1634 0202 04F16C01 		add	r1, r4, #108
 1635 0206 04F16800 		add	r0, r4, #104
 1636 020a 94ED161A 		vldr.32	s2, [r4, #88]
 1637 020e D4ED150A 		vldr.32	s1, [r4, #84]
 1638 0212 30EE270A 		vadd.f32	s0, s0, s15
 1639 0216 FFF7FEFF 		bl	abc
 1640              	.LVL120:
 283:Core/Src/foc.c ****        svm(controller->v_max, controller->v_u, controller->v_v, controller->v_w, &controller->dtc_u
 1641              		.loc 1 283 8 is_stmt 1 view .LVU503
 1642 021a 04F16402 		add	r2, r4, #100
 1643 021e 04F16001 		add	r1, r4, #96
 1644 0222 04F15C00 		add	r0, r4, #92
 1645 0226 D4ED1C1A 		vldr.32	s3, [r4, #112]
 1646 022a 94ED1B1A 		vldr.32	s2, [r4, #108]
 1647 022e D4ED1A0A 		vldr.32	s1, [r4, #104]
 1648 0232 94ED3B0A 		vldr.32	s0, [r4, #236]
 1649 0236 FFF7FEFF 		bl	svm
 1650              	.LVL121:
 284:Core/Src/foc.c **** 
 285:Core/Src/foc.c ****        set_dtc(controller);
 1651              		.loc 1 285 8 view .LVU504
 1652 023a 2046     		mov	r0, r4
 1653 023c FFF7FEFF 		bl	set_dtc
 1654              	.LVL122:
 286:Core/Src/foc.c **** 
 287:Core/Src/foc.c ****     }
ARM GAS  /tmp/ccXDZrk8.s 			page 35


 1655              		.loc 1 287 5 is_stmt 0 view .LVU505
 1656 0240 BDEC048B 		vldm	sp!, {d8-d9}
 1657              	.LCFI19:
 1658              		.cfi_restore 82
 1659              		.cfi_restore 83
 1660              		.cfi_restore 80
 1661              		.cfi_restore 81
 1662              		.cfi_def_cfa_offset 16
 1663              	.LVL123:
 1664              		.loc 1 287 5 view .LVU506
 1665 0244 38BD     		pop	{r3, r4, r5, pc}
 1666              	.LVL124:
 1667              	.L73:
 1668              		.loc 1 287 5 view .LVU507
 1669 0246 00BF     		.align	2
 1670              	.L72:
 1671 0248 00000000 		.word	__float_reg
 1672 024c 6666663F 		.word	1063675494
 1673 0250 CDCCCC3D 		.word	1036831949
 1674 0254 D7A3703F 		.word	1064346583
 1675 0258 3ACD133F 		.word	1058262330
 1676 025c 00000000 		.word	0
 1677 0260 51491D38 		.word	941443409
 1678              		.cfi_endproc
 1679              	.LFE247:
 1681              		.section	.text.torque_control,"ax",%progbits
 1682              		.align	1
 1683              		.global	torque_control
 1684              		.syntax unified
 1685              		.thumb
 1686              		.thumb_func
 1687              		.fpu fpv4-sp-d16
 1689              	torque_control:
 1690              	.LVL125:
 1691              	.LFB248:
 288:Core/Src/foc.c **** 
 289:Core/Src/foc.c **** 
 290:Core/Src/foc.c **** void torque_control(ControllerStruct *controller){
 1692              		.loc 1 290 50 is_stmt 1 view -0
 1693              		.cfi_startproc
 1694              		@ args = 0, pretend = 0, frame = 0
 1695              		@ frame_needed = 0, uses_anonymous_args = 0
 1696              		.loc 1 290 50 is_stmt 0 view .LVU509
 1697 0000 10B5     		push	{r4, lr}
 1698              	.LCFI20:
 1699              		.cfi_def_cfa_offset 8
 1700              		.cfi_offset 4, -8
 1701              		.cfi_offset 14, -4
 1702 0002 0446     		mov	r4, r0
 291:Core/Src/foc.c **** 	controller->t_ff_filt = 0.9f*controller->t_ff_filt + 0.1f*controller->t_ff;
 1703              		.loc 1 291 2 is_stmt 1 view .LVU510
 1704              		.loc 1 291 41 is_stmt 0 view .LVU511
 1705 0004 90ED2F0A 		vldr.32	s0, [r0, #188]
 1706              		.loc 1 291 30 view .LVU512
 1707 0008 DFED257A 		vldr.32	s15, .L79
 1708 000c 20EE270A 		vmul.f32	s0, s0, s15
 1709              		.loc 1 291 70 view .LVU513
ARM GAS  /tmp/ccXDZrk8.s 			page 36


 1710 0010 D0ED3A7A 		vldr.32	s15, [r0, #232]
 1711              		.loc 1 291 59 view .LVU514
 1712 0014 9FED237A 		vldr.32	s14, .L79+4
 1713 0018 67EE877A 		vmul.f32	s15, s15, s14
 1714              		.loc 1 291 53 view .LVU515
 1715 001c 30EE270A 		vadd.f32	s0, s0, s15
 1716              		.loc 1 291 24 view .LVU516
 1717 0020 80ED2F0A 		vstr.32	s0, [r0, #188]
 292:Core/Src/foc.c ****     float torque_des = controller->kp*(controller->p_des - controller->theta_mech) + controller->t_
 1718              		.loc 1 292 5 is_stmt 1 view .LVU517
 1719              		.loc 1 292 34 is_stmt 0 view .LVU518
 1720 0024 D0ED387A 		vldr.32	s15, [r0, #224]
 1721              		.loc 1 292 50 view .LVU519
 1722 0028 90ED367A 		vldr.32	s14, [r0, #216]
 1723              		.loc 1 292 70 view .LVU520
 1724 002c D0ED0A6A 		vldr.32	s13, [r0, #40]
 1725              		.loc 1 292 58 view .LVU521
 1726 0030 37EE667A 		vsub.f32	s14, s14, s13
 1727              		.loc 1 292 38 view .LVU522
 1728 0034 67EE877A 		vmul.f32	s15, s15, s14
 1729              		.loc 1 292 84 view .LVU523
 1730 0038 30EE270A 		vadd.f32	s0, s0, s15
 1731              		.loc 1 292 120 view .LVU524
 1732 003c D0ED397A 		vldr.32	s15, [r0, #228]
 1733              		.loc 1 292 136 view .LVU525
 1734 0040 90ED377A 		vldr.32	s14, [r0, #220]
 1735              		.loc 1 292 156 view .LVU526
 1736 0044 D0ED0C6A 		vldr.32	s13, [r0, #48]
 1737              		.loc 1 292 144 view .LVU527
 1738 0048 37EE667A 		vsub.f32	s14, s14, s13
 1739              		.loc 1 292 124 view .LVU528
 1740 004c 67EE877A 		vmul.f32	s15, s15, s14
 1741              		.loc 1 292 11 view .LVU529
 1742 0050 30EE270A 		vadd.f32	s0, s0, s15
 1743              	.LVL126:
 293:Core/Src/foc.c ****     controller->i_q_des = fast_fmaxf(fast_fminf(torque_des/(KT*GR), controller->i_max), -controller
 1744              		.loc 1 293 5 is_stmt 1 view .LVU530
 1745              		.loc 1 293 61 is_stmt 0 view .LVU531
 1746 0054 144B     		ldr	r3, .L79+8
 1747 0056 D3ED0E7A 		vldr.32	s15, [r3, #56]
 1748              		.loc 1 293 64 view .LVU532
 1749 005a 93ED117A 		vldr.32	s14, [r3, #68]
 1750              		.loc 1 293 63 view .LVU533
 1751 005e 67EE877A 		vmul.f32	s15, s15, s14
 1752              		.loc 1 293 27 view .LVU534
 1753 0062 D0ED400A 		vldr.32	s1, [r0, #256]
 1754 0066 80EE270A 		vdiv.f32	s0, s0, s15
 1755              	.LVL127:
 1756              		.loc 1 293 27 view .LVU535
 1757 006a FFF7FEFF 		bl	fast_fminf
 1758              	.LVL128:
 1759              		.loc 1 293 100 view .LVU536
 1760 006e D4ED400A 		vldr.32	s1, [r4, #256]
 1761              		.loc 1 293 27 view .LVU537
 1762 0072 F1EE600A 		vneg.f32	s1, s1
 1763 0076 FFF7FEFF 		bl	fast_fmaxf
 1764              	.LVL129:
ARM GAS  /tmp/ccXDZrk8.s 			page 37


 1765              		.loc 1 293 25 view .LVU538
 1766 007a 84ED2C0A 		vstr.32	s0, [r4, #176]
 294:Core/Src/foc.c ****     if(controller->v_bus > V_BUS_MAX){controller->i_q_des = 0;}
 1767              		.loc 1 294 5 is_stmt 1 view .LVU539
 1768              		.loc 1 294 18 is_stmt 0 view .LVU540
 1769 007e 94ED087A 		vldr.32	s14, [r4, #32]
 1770              		.loc 1 294 7 view .LVU541
 1771 0082 DFED0A7A 		vldr.32	s15, .L79+12
 1772 0086 B4EEE77A 		vcmpe.f32	s14, s15
 1773 008a F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1774 008e 02DD     		ble	.L75
 1775              		.loc 1 294 39 is_stmt 1 discriminator 1 view .LVU542
 1776              		.loc 1 294 59 is_stmt 0 discriminator 1 view .LVU543
 1777 0090 0023     		movs	r3, #0
 1778 0092 C4F8B030 		str	r3, [r4, #176]	@ float
 1779              	.L75:
 295:Core/Src/foc.c ****     controller->i_d_des = 0.0f;
 1780              		.loc 1 295 5 is_stmt 1 view .LVU544
 1781              		.loc 1 295 25 is_stmt 0 view .LVU545
 1782 0096 0023     		movs	r3, #0
 1783 0098 C4F8AC30 		str	r3, [r4, #172]	@ float
 296:Core/Src/foc.c **** 
 297:Core/Src/foc.c ****     }
 1784              		.loc 1 297 5 view .LVU546
 1785 009c 10BD     		pop	{r4, pc}
 1786              	.LVL130:
 1787              	.L80:
 1788              		.loc 1 297 5 view .LVU547
 1789 009e 00BF     		.align	2
 1790              	.L79:
 1791 00a0 6666663F 		.word	1063675494
 1792 00a4 CDCCCC3D 		.word	1036831949
 1793 00a8 00000000 		.word	__float_reg
 1794 00ac 00002042 		.word	1109393408
 1795              		.cfi_endproc
 1796              	.LFE248:
 1798              		.section	.text.zero_commands,"ax",%progbits
 1799              		.align	1
 1800              		.global	zero_commands
 1801              		.syntax unified
 1802              		.thumb
 1803              		.thumb_func
 1804              		.fpu fpv4-sp-d16
 1806              	zero_commands:
 1807              	.LVL131:
 1808              	.LFB249:
 298:Core/Src/foc.c **** 
 299:Core/Src/foc.c **** 
 300:Core/Src/foc.c **** 
 301:Core/Src/foc.c **** void zero_commands(ControllerStruct * controller){
 1809              		.loc 1 301 50 is_stmt 1 view -0
 1810              		.cfi_startproc
 1811              		@ args = 0, pretend = 0, frame = 0
 1812              		@ frame_needed = 0, uses_anonymous_args = 0
 1813              		@ link register save eliminated.
 302:Core/Src/foc.c **** 	controller->t_ff = 0;
 1814              		.loc 1 302 2 view .LVU549
ARM GAS  /tmp/ccXDZrk8.s 			page 38


 1815              		.loc 1 302 19 is_stmt 0 view .LVU550
 1816 0000 0023     		movs	r3, #0
 1817 0002 C0F8E830 		str	r3, [r0, #232]	@ float
 303:Core/Src/foc.c **** 	controller->kp = 0;
 1818              		.loc 1 303 2 is_stmt 1 view .LVU551
 1819              		.loc 1 303 17 is_stmt 0 view .LVU552
 1820 0006 C0F8E030 		str	r3, [r0, #224]	@ float
 304:Core/Src/foc.c **** 	controller->kd = 0;
 1821              		.loc 1 304 2 is_stmt 1 view .LVU553
 1822              		.loc 1 304 17 is_stmt 0 view .LVU554
 1823 000a C0F8E430 		str	r3, [r0, #228]	@ float
 305:Core/Src/foc.c **** 	controller->p_des = 0;
 1824              		.loc 1 305 2 is_stmt 1 view .LVU555
 1825              		.loc 1 305 20 is_stmt 0 view .LVU556
 1826 000e C0F8D830 		str	r3, [r0, #216]	@ float
 306:Core/Src/foc.c **** 	controller->v_des = 0;
 1827              		.loc 1 306 2 is_stmt 1 view .LVU557
 1828              		.loc 1 306 20 is_stmt 0 view .LVU558
 1829 0012 C0F8DC30 		str	r3, [r0, #220]	@ float
 307:Core/Src/foc.c **** 	controller->i_q_des = 0;
 1830              		.loc 1 307 2 is_stmt 1 view .LVU559
 1831              		.loc 1 307 22 is_stmt 0 view .LVU560
 1832 0016 C0F8B030 		str	r3, [r0, #176]	@ float
 308:Core/Src/foc.c **** }
 1833              		.loc 1 308 1 view .LVU561
 1834 001a 7047     		bx	lr
 1835              		.cfi_endproc
 1836              	.LFE249:
 1838              		.text
 1839              	.Letext0:
 1840              		.file 2 "/usr/lib/gcc/arm-none-eabi/9.2.1/include/stdint.h"
 1841              		.file 3 "Drivers/CMSIS/Include/core_cm4.h"
 1842              		.file 4 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/system_stm32f4xx.h"
 1843              		.file 5 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f446xx.h"
 1844              		.file 6 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f4xx.h"
 1845              		.file 7 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_def.h"
 1846              		.file 8 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_dma.h"
 1847              		.file 9 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_adc.h"
 1848              		.file 10 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_spi.h"
 1849              		.file 11 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_tim.h"
 1850              		.file 12 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal.h"
 1851              		.file 13 "Core/Inc/spi.h"
 1852              		.file 14 "Core/Inc/position_sensor.h"
 1853              		.file 15 "Core/Inc/foc.h"
 1854              		.file 16 "Core/Inc/adc.h"
 1855              		.file 17 "Core/Inc/tim.h"
 1856              		.file 18 "/usr/lib/gcc/arm-none-eabi/9.2.1/include/stddef.h"
 1857              		.file 19 "/usr/include/newlib/sys/_types.h"
 1858              		.file 20 "/usr/include/newlib/sys/reent.h"
 1859              		.file 21 "/usr/include/newlib/sys/lock.h"
 1860              		.file 22 "/usr/include/newlib/math.h"
 1861              		.file 23 "Core/Inc/user_config.h"
 1862              		.file 24 "Core/Inc/math_ops.h"
ARM GAS  /tmp/ccXDZrk8.s 			page 39


DEFINED SYMBOLS
                            *ABS*:0000000000000000 foc.c
     /tmp/ccXDZrk8.s:18     .text.set_dtc:0000000000000000 $t
     /tmp/ccXDZrk8.s:26     .text.set_dtc:0000000000000000 set_dtc
     /tmp/ccXDZrk8.s:119    .text.set_dtc:00000000000000a8 $d
     /tmp/ccXDZrk8.s:125    .text.analog_sample:0000000000000000 $t
     /tmp/ccXDZrk8.s:132    .text.analog_sample:0000000000000000 analog_sample
     /tmp/ccXDZrk8.s:259    .text.analog_sample:00000000000000a0 $d
     /tmp/ccXDZrk8.s:268    .text.abc:0000000000000000 $t
     /tmp/ccXDZrk8.s:275    .text.abc:0000000000000000 abc
     /tmp/ccXDZrk8.s:384    .text.abc:0000000000000094 $d
     /tmp/ccXDZrk8.s:390    .text.dq0:0000000000000000 $t
     /tmp/ccXDZrk8.s:397    .text.dq0:0000000000000000 dq0
     /tmp/ccXDZrk8.s:516    .text.dq0:00000000000000a0 $d
     /tmp/ccXDZrk8.s:523    .text.svm:0000000000000000 $t
     /tmp/ccXDZrk8.s:530    .text.svm:0000000000000000 svm
     /tmp/ccXDZrk8.s:668    .text.svm:00000000000000cc $d
     /tmp/ccXDZrk8.s:675    .text.zero_current:0000000000000000 $t
     /tmp/ccXDZrk8.s:682    .text.zero_current:0000000000000000 zero_current
     /tmp/ccXDZrk8.s:781    .text.zero_current:0000000000000050 $d
     /tmp/ccXDZrk8.s:790    .text.init_controller_params:0000000000000000 $t
     /tmp/ccXDZrk8.s:797    .text.init_controller_params:0000000000000000 init_controller_params
     /tmp/ccXDZrk8.s:948    .text.init_controller_params:00000000000000e4 $d
     /tmp/ccXDZrk8.s:966    .text.reset_foc:0000000000000000 $t
     /tmp/ccXDZrk8.s:973    .text.reset_foc:0000000000000000 reset_foc
     /tmp/ccXDZrk8.s:1052   .text.reset_foc:000000000000006c $d
     /tmp/ccXDZrk8.s:1057   .text.reset_observer:0000000000000000 $t
     /tmp/ccXDZrk8.s:1064   .text.reset_observer:0000000000000000 reset_observer
     /tmp/ccXDZrk8.s:1078   .text.update_observer:0000000000000000 $t
     /tmp/ccXDZrk8.s:1085   .text.update_observer:0000000000000000 update_observer
     /tmp/ccXDZrk8.s:1099   .text.linearize_dtc:0000000000000000 $t
     /tmp/ccXDZrk8.s:1106   .text.linearize_dtc:0000000000000000 linearize_dtc
     /tmp/ccXDZrk8.s:1179   .text.linearize_dtc:0000000000000064 $d
     /tmp/ccXDZrk8.s:1187   .text.field_weaken:0000000000000000 $t
     /tmp/ccXDZrk8.s:1194   .text.field_weaken:0000000000000000 field_weaken
     /tmp/ccXDZrk8.s:1325   .text.field_weaken:00000000000000c4 $d
     /tmp/ccXDZrk8.s:1331   .text.commutate:0000000000000000 $t
     /tmp/ccXDZrk8.s:1338   .text.commutate:0000000000000000 commutate
     /tmp/ccXDZrk8.s:1671   .text.commutate:0000000000000248 $d
     /tmp/ccXDZrk8.s:1682   .text.torque_control:0000000000000000 $t
     /tmp/ccXDZrk8.s:1689   .text.torque_control:0000000000000000 torque_control
     /tmp/ccXDZrk8.s:1791   .text.torque_control:00000000000000a0 $d
     /tmp/ccXDZrk8.s:1799   .text.zero_commands:0000000000000000 $t
     /tmp/ccXDZrk8.s:1806   .text.zero_commands:0000000000000000 zero_commands

UNDEFINED SYMBOLS
__int_reg
htim1
HAL_ADC_GetValue
HAL_ADC_Start
HAL_ADC_PollForConversion
hadc1
hadc2
hadc3
cos_lut
sin_lut
fminf3
ARM GAS  /tmp/ccXDZrk8.s 			page 40


fmaxf3
fast_fmaxf
fast_fminf
__aeabi_f2d
__aeabi_dmul
__aeabi_dadd
__aeabi_d2f
exp
__float_reg
sqrtf
limit_norm
